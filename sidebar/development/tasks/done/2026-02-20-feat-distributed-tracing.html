<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-sidebar/development/tasks/done/2026-02-20-feat-distributed-tracing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Distributed tracing with OpenTelemetry | OSAPI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://osapi-io.github.io/osapi/sidebar/development/tasks/done/2026-02-20-feat-distributed-tracing"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Distributed tracing with OpenTelemetry | OSAPI"><meta data-rh="true" name="description" content="Objective"><meta data-rh="true" property="og:description" content="Objective"><link data-rh="true" rel="icon" href="/osapi/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://osapi-io.github.io/osapi/sidebar/development/tasks/done/2026-02-20-feat-distributed-tracing"><link data-rh="true" rel="alternate" href="https://osapi-io.github.io/osapi/sidebar/development/tasks/done/2026-02-20-feat-distributed-tracing" hreflang="en"><link data-rh="true" rel="alternate" href="https://osapi-io.github.io/osapi/sidebar/development/tasks/done/2026-02-20-feat-distributed-tracing" hreflang="x-default"><link rel="stylesheet" href="/osapi/assets/css/styles.56a51dbd.css">
<script src="/osapi/assets/js/runtime~main.40185e86.js" defer="defer"></script>
<script src="/osapi/assets/js/main.c301eed7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/osapi/"><div class="navbar__logo"><img src="/osapi/img/logo.png" alt="OSAPI Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/osapi/img/logo.png" alt="OSAPI Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OSAPI</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/osapi/">Getting Started</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Features</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/system-management">System Management</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/network-management">Network Management</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/job-system">Job System</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/audit-logging">Audit Logging</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/command-execution">Command Execution</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/health-checks">Health Checks</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/authentication">Authentication &amp; RBAC</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/distributed-tracing">Distributed Tracing</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/osapi/sidebar/features/metrics">Metrics</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/osapi/sidebar/usage">Usage</a><a class="navbar__item navbar__link" href="/osapi/category/api">API</a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/osapi/sidebar/development/tasks/done/2026-02-20-feat-distributed-tracing">Next</a><a href="https://github.com/retr0h/osapi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/osapi/">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/osapi/sidebar/usage">Usage</a><button aria-label="Expand sidebar category &#x27;Usage&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/osapi/category/features">Features</a><button aria-label="Expand sidebar category &#x27;Features&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/osapi/sidebar/architecture">Architecture</a><button aria-label="Expand sidebar category &#x27;Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/osapi/sidebar/development">Development</a><button aria-label="Collapse sidebar category &#x27;Development&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/contributing">Contributing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/testing">Testing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/osapi/sidebar/development/tasks">Tasks</a><button aria-label="Collapse sidebar category &#x27;Tasks&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/osapi/category/done">Done</a><button aria-label="Collapse sidebar category &#x27;Done&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-chore-delete-legacy-task">Delete legacy task system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-docs-cli-doc-consistency">Audit and standardize CLI documentation formatting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-docs-feature-roadmap">Document feature roadmap with tiered priorities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-docs-rest-nats-vs-grpc-analysis">Architecture analysis — REST+NATS vs gRPC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-docs-update-docusaurus">Update Docusaurus docs for job system migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-feat-audit-logging">Audit logging for API operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-feat-command-execution">Ad-hoc command execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-feat-health-endpoint">Health check and readiness endpoints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-feat-job-api-domain">Create job API domain (replace task API)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-fix-api-endpoint-validation-audit">Audit and ensure validation on all API endpoints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-refactor-network-api-strict-server">Port network API to strict-server + job client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-refactor-operation-naming">Fix operation naming inconsistencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-refactor-server-lifecycle-consistency">Standardize server/worker CLI lifecycle and context handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-refactor-system-api-job-client">Port system API to use job client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-test-consistency-audit">Consistency pass and test coverage audit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-15-test-verify-multi-system-routing">Verify multi-system routing and per-system response aggregation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-16-feat-broadcast-response-collection">Implement broadcast (_all) response collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-16-feat-darwin-providers">Add Darwin development providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-chore-evaluate-orbit-go">Evaluate synadia-io/orbit.go for NATS integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-docs-add-ai-policy">Add AI policy to the project</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-feat-api-list-nats-workers">API endpoint to list registered NATS workers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-feat-cli-consistent-host-targeting">Add consistent host targeting to all CLI commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-feat-label-based-worker-routing">Label-based worker routing with NATS subject wildcards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-fix-api-input-validation-hardening">Complete API input validation hardening</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-refactor-migrate-client-job-to-rest-api">Migrate client job commands from direct NATS to REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-refactor-rename-util-validate">Rename cmd/util_*.go files to descriptive names</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-test-coverage-100-percent">Achieve 100% test coverage on non-generated packages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-17-test-mock-audit-cleanup">Audit and clean up mocks repo-wide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-18-docs-cli-docs-audit">Audit CLI commands and docs for consistency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-18-docs-configuration-reference">Add configuration reference documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-18-fix-dotted-hostname-routing">Fix dotted hostname breaks NATS subject routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-19-feat-consistent-debug-logging">Consistent debug logging across all components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-19-feat-health-status">Rename health detailed to health status and enrich with system metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-19-feat-job-retry-command">Add job retry command</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-19-fix-job-list-pagination">Add server-side pagination to job list</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-19-quick-wins-job-id-tracing">Surface job IDs in API responses and CLI output</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-20-feat-distributed-tracing">Distributed tracing with OpenTelemetry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-20-feat-metrics-endpoint">HTTP metrics with Prometheus endpoint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-20-feat-nats-auth-namespaces">Add NATS authentication and namespace support to config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-20-refactor-nats-config">Refactor NATS config so each consumer owns its connection settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-21-docs-features-section">Add Features documentation section</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-21-feat-audit-log-export-backends">Support audit log export to alternative backends</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-21-feat-rbac-enforcement">RBAC enforcement with fine-grained permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-21-feat-show-worker-labels">Show worker labels in system hostname output</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-21-fix-broadcast-silent-failures">Surface failed worker responses in broadcast query results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/tasks/done/2026-02-21-fix-trace-propagation">Fix trace context propagation from API server to worker via NATS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/osapi/category/backlog">Backlog</a><button aria-label="Expand sidebar category &#x27;Backlog&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/osapi/category/sessions">Sessions</a><button aria-label="Expand sidebar category &#x27;Sessions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/osapi/sidebar/development/roadmap">Roadmap</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/osapi/category/api">API</a><button aria-label="Expand sidebar category &#x27;API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/osapi/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/osapi/sidebar/development"><span itemprop="name">Development</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/osapi/sidebar/development/tasks"><span itemprop="name">Tasks</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/osapi/category/done"><span itemprop="name">Done</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Distributed tracing with OpenTelemetry</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Distributed tracing with OpenTelemetry</h1></header><div class="row"><div class="col col--12 markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="objective">Objective<a href="#objective" class="hash-link" aria-label="Direct link to Objective" title="Direct link to Objective">​</a></h2>
<p>Add end-to-end distributed tracing using OpenTelemetry (OTel) so that a single
trace ID follows a request from CLI or API origin, through NATS messaging, to
worker execution and back. After this work, filtering logs by trace ID should
show the full flow of any request across all components.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisite">Prerequisite<a href="#prerequisite" class="hash-link" aria-label="Direct link to Prerequisite" title="Direct link to Prerequisite">​</a></h2>
<p>Job IDs are already surfaced in API responses and CLI output (done). This task
adds trace context propagation so that the trace ID correlates all log lines and
spans across components automatically.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="approach">Approach<a href="#approach" class="hash-link" aria-label="Direct link to Approach" title="Direct link to Approach">​</a></h2>
<p>Use the OpenTelemetry Go SDK (CNCF standard):</p>
<ul>
<li><strong>Trace ID as correlation ID</strong> — W3C <code>traceparent</code> header carries a globally
unique trace ID across HTTP and NATS boundaries</li>
<li><strong>Automatic context propagation</strong> — no custom headers needed</li>
<li><strong>Span-based instrumentation</strong> — each operation (HTTP request, KV read, job
processing) becomes a span with timing and attributes</li>
<li><strong>slog integration</strong> — <code>otelslog</code> bridge attaches <code>trace_id</code> and <code>span_id</code> to
all structured log lines automatically</li>
<li><strong>Echo middleware</strong> — <code>otelecho</code> instruments all HTTP handlers with zero
per-handler code</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-go-packages">Key Go Packages<a href="#key-go-packages" class="hash-link" aria-label="Direct link to Key Go Packages" title="Direct link to Key Go Packages">​</a></h3>
<ul>
<li><code>go.opentelemetry.io/otel</code> — core API</li>
<li><code>go.opentelemetry.io/otel/sdk/trace</code> — trace SDK</li>
<li><code>go.opentelemetry.io/contrib/instrumentation/github.com/labstack/echo/otelecho</code>
— Echo middleware</li>
<li><code>go.opentelemetry.io/otel/exporters/stdout/stdouttrace</code> — stdout exporter for
debug mode</li>
<li><code>go.opentelemetry.io/otel/exporters/otlp/otlptrace</code> — OTLP exporter for
production backends (Jaeger, Tempo, etc.)</li>
<li><code>go.opentelemetry.io/otel/bridge/otelslog</code> — slog bridge</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="scope">Scope<a href="#scope" class="hash-link" aria-label="Direct link to Scope" title="Direct link to Scope">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tracer-provider-setup">Tracer Provider Setup<a href="#tracer-provider-setup" class="hash-link" aria-label="Direct link to Tracer Provider Setup" title="Direct link to Tracer Provider Setup">​</a></h3>
<ul>
<li>Initialize OTel tracer provider at startup in API server, worker, and CLI</li>
<li>Use stdout exporter when <code>--debug</code> is enabled</li>
<li>Use OTLP exporter when configured (optional, for production)</li>
<li>Use noop tracer when tracing is not enabled (zero overhead)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="http-layer-echo-api-server">HTTP Layer (Echo API Server)<a href="#http-layer-echo-api-server" class="hash-link" aria-label="Direct link to HTTP Layer (Echo API Server)" title="Direct link to HTTP Layer (Echo API Server)">​</a></h3>
<ul>
<li>Add <code>otelecho</code> middleware to instrument all HTTP handlers</li>
<li>Trace context propagates automatically via W3C <code>traceparent</code> header</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="http-client-cli--api">HTTP Client (CLI → API)<a href="#http-client-cli--api" class="hash-link" aria-label="Direct link to HTTP Client (CLI → API)" title="Direct link to HTTP Client (CLI → API)">​</a></h3>
<ul>
<li>Inject OTel propagator into HTTP client so outgoing requests carry
<code>traceparent</code></li>
<li>CLI creates root span, API server continues the trace</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nats-propagation">NATS Propagation<a href="#nats-propagation" class="hash-link" aria-label="Direct link to NATS Propagation" title="Direct link to NATS Propagation">​</a></h3>
<ul>
<li>nats-client <code>Publish</code> automatically injects W3C <code>traceparent</code> into NATS
message headers via OTel — callers just pass <code>ctx</code></li>
<li>Worker extracts trace context from NATS message headers</li>
<li>Header keys are normalized on extraction because NATS JetStream delivers
headers with non-canonical casing (lowercase <code>traceparent</code> instead of
<code>Traceparent</code>), which breaks <code>http.Header.Get</code> lookups</li>
<li>This links API-side spans to worker-side spans under the same trace</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="worker-spans">Worker Spans<a href="#worker-spans" class="hash-link" aria-label="Direct link to Worker Spans" title="Direct link to Worker Spans">​</a></h3>
<ul>
<li>Create spans for job processing, provider execution, result writes</li>
<li>Attach job ID, operation type, and target as span attributes</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="slog-integration">slog Integration<a href="#slog-integration" class="hash-link" aria-label="Direct link to slog Integration" title="Direct link to slog Integration">​</a></h3>
<ul>
<li>Use <code>otelslog</code> bridge so that <code>trace_id</code> and <code>span_id</code> appear in all
structured log lines automatically</li>
<li>Enables <code>grep trace_id=&lt;hex&gt;</code> to see full end-to-end flow in logs</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h3>
<p>Add optional config section to <code>osapi.yaml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">telemetry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">tracing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Enable tracing (default: false, --debug also enables stdout)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OTLP endpoint for production tracing backends</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># otlp_endpoint: &quot;localhost:4317&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="components-to-update">Components to Update<a href="#components-to-update" class="hash-link" aria-label="Direct link to Components to Update" title="Direct link to Components to Update">​</a></h3>
<ul>
<li><code>cmd/api_server_start.go</code> — init tracer provider, add <code>otelecho</code></li>
<li><code>cmd/job_worker_start.go</code> — init tracer provider for worker</li>
<li><code>cmd/</code> (CLI commands) — init tracer provider, create root spans</li>
<li><code>internal/client/</code> — inject OTel propagator into HTTP client</li>
<li><code>internal/job/client/</code> — inject trace context into NATS headers</li>
<li><code>internal/job/worker/</code> — extract trace context from NATS headers, create
processing spans</li>
<li><code>internal/config/</code> — add <code>telemetry.tracing</code> config section</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="notes">Notes<a href="#notes" class="hash-link" aria-label="Direct link to Notes" title="Direct link to Notes">​</a></h2>
<ul>
<li>NATS does not have an official OTel instrumentation library, so trace context
injection/extraction will be manual (set/read <code>traceparent</code> header on
messages)</li>
<li>Keep backwards compatible — missing trace context should not cause errors,
just start a new trace</li>
<li>The stdout exporter is sufficient for <code>--debug</code> — no Jaeger needed during
development</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="outcome">Outcome<a href="#outcome" class="hash-link" aria-label="Direct link to Outcome" title="Direct link to Outcome">​</a></h2>
<p>Implemented end-to-end distributed tracing with OpenTelemetry:</p>
<ul>
<li>Created <code>internal/telemetry/</code> package with tracer initialization, header and
map-based trace propagation, and slog trace handler</li>
<li>Added <code>Telemetry</code> and <code>TracingConfig</code> types to <code>internal/config/</code></li>
<li>Added <code>otelecho</code> middleware to the Echo API server</li>
<li>Injected <code>traceparent</code> into HTTP client outgoing requests</li>
<li>nats-client <code>Publish</code> transparently injects trace context into NATS message
headers via OTel propagator — no caller changes needed</li>
<li>Worker extracts trace context from NATS message headers and creates a
<code>job.process</code> span with job attributes</li>
<li>Header key normalization handles NATS JetStream delivering headers with
non-canonical casing (lowercase instead of canonical MIME format)</li>
<li>All slog output automatically includes <code>trace_id</code> and <code>span_id</code> when a span is
active</li>
<li>Tracer provider initialized at startup in API server, worker, and CLI with
proper shutdown</li>
<li>Debug mode auto-enables stdout tracing</li>
<li>Updated <code>osapi.yaml</code> and configuration docs</li>
<li>All tests pass (9 new tests in telemetry package including non-canonical
header roundtrip, all existing tests passing)</li>
</ul></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/osapi/sidebar/development/tasks/done/2026-02-19-quick-wins-job-id-tracing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Surface job IDs in API responses and CLI output</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/osapi/sidebar/development/tasks/done/2026-02-20-feat-metrics-endpoint"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">HTTP metrics with Prometheus endpoint</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objective" class="table-of-contents__link toc-highlight">Objective</a></li><li><a href="#prerequisite" class="table-of-contents__link toc-highlight">Prerequisite</a></li><li><a href="#approach" class="table-of-contents__link toc-highlight">Approach</a><ul><li><a href="#key-go-packages" class="table-of-contents__link toc-highlight">Key Go Packages</a></li></ul></li><li><a href="#scope" class="table-of-contents__link toc-highlight">Scope</a><ul><li><a href="#tracer-provider-setup" class="table-of-contents__link toc-highlight">Tracer Provider Setup</a></li><li><a href="#http-layer-echo-api-server" class="table-of-contents__link toc-highlight">HTTP Layer (Echo API Server)</a></li><li><a href="#http-client-cli--api" class="table-of-contents__link toc-highlight">HTTP Client (CLI → API)</a></li><li><a href="#nats-propagation" class="table-of-contents__link toc-highlight">NATS Propagation</a></li><li><a href="#worker-spans" class="table-of-contents__link toc-highlight">Worker Spans</a></li><li><a href="#slog-integration" class="table-of-contents__link toc-highlight">slog Integration</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#components-to-update" class="table-of-contents__link toc-highlight">Components to Update</a></li></ul></li><li><a href="#notes" class="table-of-contents__link toc-highlight">Notes</a></li><li><a href="#outcome" class="table-of-contents__link toc-highlight">Outcome</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/retr0h/osapi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 <a href="https://github.com/retr0h">@retr0h</a></div></div></div></footer></div>
</body>
</html>