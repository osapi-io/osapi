---
debug: true

api:
  client:
    url: http://0.0.0.0:8080
    security:
      # admin
      # bearer_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlcyI6WyJhZG1pbiJdLCJpc3MiOiJvc2FwaSIsInN1YiI6ImpvaG5AZGV3ZXkud3MiLCJhdWQiOlsiaHR0cHM6Ly9sb2NhbGhvc3QiLCJodHRwOi8vbG9jYWxob3N0Il0sImV4cCI6MTc0MDg2NDIxNywiaWF0IjoxNzMyOTE1NDE3fQ.0YBwFSKXs2G16TACO-uDsIklPhaYNw63-q95IeNuneU
      # read
      bearer_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlcyI6WyJhZG1pbiJdLCJpc3MiOiJvc2FwaSIsInN1YiI6ImpvaG5AZGV3ZXkud3MiLCJhdWQiOlsiaHR0cHM6Ly9sb2NhbGhvc3QiLCJodHRwOi8vbG9jYWxob3N0Il0sImV4cCI6MTc3ODk2MjI3MiwiaWF0IjoxNzcxMjc2MjcyfQ.G_Ezc7J1lGPQdAtWumObuCFMMi4zPIErNk7dD__66Rk
  server:
    port: 8080
    nats:
      host: localhost
      port: 4222
      client_name: osapi-api
      namespace: osapi
      auth:
        type: none
    security:
      # openssl rand -hex 32
      signing_key: 111fdb0cfd9788fa6af8815f856a0374bf7a0174ad62fa8b98ec07a55f68d8d8
      cors:
        allow_origins:
          - http://localhost:3001
          - https://osapi-io.github.io
      # Custom roles with fine-grained permissions.
      # Built-in roles (admin, write, read) expand to default permissions
      # unless overridden here. Permissions use resource:verb format.
      # Available: system:read, network:read, network:write,
      #            job:read, job:write, health:read
      # roles:
      #   ops:
      #     permissions:
      #       - system:read
      #       - health:read
      #   netadmin:
      #     permissions:
      #       - network:read
      #       - network:write
      #       - health:read

nats:
  server:
    host: localhost
    port: 4222
    store_dir: .nats/jetstream/
    namespace: osapi
    auth:
      type: none
      # users:
      #   - username: osapi
      #     password: '<secret>'
      # nkeys:
      #   - '<public-nkey>'

  stream:
    name: JOBS
    subjects: jobs.>
    max_age: 24h
    max_msgs: 10000
    storage: file
    replicas: 1
    discard: old

  kv:
    bucket: job-queue
    response_bucket: job-responses
    ttl: 1h
    max_bytes: 104857600
    storage: file
    replicas: 1

  dlq:
    max_age: 7d
    max_msgs: 1000
    storage: file
    replicas: 1

telemetry:
  tracing:
    enabled: true
    # exporter: stdout
    # otlp_endpoint: localhost:4317
  metrics:
    path: /metrics

job:
  worker:
    nats:
      host: localhost
      port: 4222
      client_name: osapi-job-worker
      namespace: osapi
      auth:
        type: none
    consumer:
      name: jobs-worker
      max_deliver: 5
      ack_wait: 2m
      max_ack_pending: 1000
      replay_policy: instant
      back_off:
        - 30s
        - 2m
        - 5m
        - 15m
        - 30m
    queue_group: job-workers
    hostname: ""  # defaults to system hostname
    max_jobs: 10
    labels:
      group: web.dev.us-east  # hierarchical: --target group:web, group:web.dev, etc.
