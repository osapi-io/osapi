"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1046],{29527(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>o});var t=i(74848),r=i(28453);const s={sidebar_position:4},d="Audit Logging",a={id:"sidebar/features/audit-logging",title:"Audit Logging",description:"OSAPI records a structured audit trail of every API request. Audit entries",source:"@site/docs/sidebar/features/audit-logging.md",sourceDirName:"sidebar/features",slug:"/sidebar/features/audit-logging",permalink:"/osapi/sidebar/features/audit-logging",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"testSidebar",previous:{title:"Job System",permalink:"/osapi/sidebar/features/job-system"},next:{title:"Health Checks",permalink:"/osapi/sidebar/features/health-checks"}},l={},o=[{value:"How It Works",id:"how-it-works",level:2},{value:"Viewing Audit Logs",id:"viewing-audit-logs",level:2},{value:"Export",id:"export",level:2},{value:"Retention",id:"retention",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Permissions",id:"permissions",level:2},{value:"Related",id:"related",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"audit-logging",children:"Audit Logging"})}),"\n",(0,t.jsx)(n.p,{children:"OSAPI records a structured audit trail of every API request. Audit entries\ncapture who made the request, what they did, and how long it took. This provides\naccountability and supports compliance requirements."}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsx)(n.p,{children:"The API server records audit entries automatically via middleware. Every\nauthenticated request generates an audit entry that is stored in a dedicated\nNATS KV bucket. No application code needs to explicitly log audit events -- the\nmiddleware handles it transparently."}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Middleware as Audit Middleware\n    participant Handler\n    participant KV as NATS KV\n\n    Client->>Middleware: API request\n    Middleware->>Handler: forward request\n    Handler--\x3e>Middleware: response\n    Middleware->>KV: write audit entry\n    Middleware--\x3e>Client: response"}),"\n",(0,t.jsx)(n.p,{children:"Each audit entry contains:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"id"})}),(0,t.jsx)(n.td,{children:"Unique entry identifier (UUID)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"timestamp"})}),(0,t.jsx)(n.td,{children:"When the request was made"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"user"})}),(0,t.jsxs)(n.td,{children:["Identity from the JWT ",(0,t.jsx)(n.code,{children:"sub"})," claim"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"roles"})}),(0,t.jsx)(n.td,{children:"Roles from the JWT token"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"method"})}),(0,t.jsxs)(n.td,{children:["HTTP method (",(0,t.jsx)(n.code,{children:"GET"}),", ",(0,t.jsx)(n.code,{children:"POST"}),", etc.)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"path"})}),(0,t.jsxs)(n.td,{children:["Request path (e.g., ",(0,t.jsx)(n.code,{children:"/node/hostname"}),")"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"operation_id"})}),(0,t.jsx)(n.td,{children:"OpenAPI operation ID (if available)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"source_ip"})}),(0,t.jsx)(n.td,{children:"Client IP address"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"response_code"})}),(0,t.jsx)(n.td,{children:"HTTP response status code"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"duration_ms"})}),(0,t.jsx)(n.td,{children:"Request processing time in milliseconds"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"viewing-audit-logs",children:"Viewing Audit Logs"}),"\n",(0,t.jsxs)(n.p,{children:["Query audit entries through the API or CLI. You can list recent entries\n(paginated), get a specific entry by ID, or export all entries. See\n",(0,t.jsx)(n.a,{href:"/osapi/sidebar/usage/cli/client/audit/",children:"CLI Reference"})," for usage and examples, or\nthe ",(0,t.jsx)(n.a,{href:"/gen/api/audit-log-api-audit",children:"API Reference"})," for the REST endpoints."]}),"\n",(0,t.jsx)(n.h2,{id:"export",children:"Export"}),"\n",(0,t.jsx)(n.p,{children:"The export feature retrieves all audit entries and writes them to a local file\nin JSONL format (one JSON object per line). This is designed for long-term\nretention -- since audit entries in NATS KV have a configurable TTL (default 30\ndays), exporting preserves them before they expire."}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"GET /audit/export"})," endpoint returns all entries in a single response. The\nCLI writes each entry as a JSON line to the output file. JSONL files are easy to\nprocess with standard tools:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Count entries\nwc -l audit.jsonl\n\n# Filter by user\ngrep \'"user":"ops@example.com"\' audit.jsonl\n\n# Pretty-print with jq\ncat audit.jsonl | jq .\n'})}),"\n",(0,t.jsx)(n.h2,{id:"retention",children:"Retention"}),"\n",(0,t.jsx)(n.p,{children:"Audit entries are stored in a NATS KV bucket with configurable retention\nsettings. When entries exceed the TTL or the bucket reaches its size limit,\nolder entries are automatically removed. Export entries before they expire if\nyou need long-term retention."}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"nats:\n  audit:\n    bucket: 'audit-log' # KV bucket name\n    ttl: '720h' # 30-day retention (default)\n    max_bytes: 52428800 # 50 MiB max bucket size\n    storage: 'file' # \"file\" or \"memory\"\n    replicas: 1 # Number of KV replicas\n"})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"/osapi/sidebar/usage/configuration#natsaudit",children:"Configuration"})," for the full reference."]}),"\n",(0,t.jsx)(n.h2,{id:"permissions",children:"Permissions"}),"\n",(0,t.jsxs)(n.p,{children:["All audit endpoints require the ",(0,t.jsx)(n.code,{children:"audit:read"})," permission. Only the ",(0,t.jsx)(n.code,{children:"admin"})," role\nincludes this permission by default."]}),"\n",(0,t.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/usage/cli/client/audit/",children:"CLI Reference"})," -- audit commands (list,\nget, export)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/gen/api/audit-log-api-audit",children:"API Reference"})," -- REST API documentation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/usage/configuration",children:"Configuration"})," -- full configuration reference"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453(e,n,i){i.d(n,{R:()=>d,x:()=>a});var t=i(96540);const r={},s=t.createContext(r);function d(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);