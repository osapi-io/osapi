"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2699],{83512(e,t,s){s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var n=s(74848),r=s(28453);const a={title:"Enhance health status with agents and consumers",status:"backlog",created:new Date("2026-02-26T00:00:00.000Z"),updated:new Date("2026-02-26T00:00:00.000Z")},i=void 0,o={id:"sidebar/development/tasks/backlog/2026-02-26-feat-health-status-enhancements",title:"Enhance health status with agents and consumers",description:"Objective",source:"@site/docs/sidebar/development/tasks/backlog/2026-02-26-feat-health-status-enhancements.md",sourceDirName:"sidebar/development/tasks/backlog",slug:"/sidebar/development/tasks/backlog/2026-02-26-feat-health-status-enhancements",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-26-feat-health-status-enhancements",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Enhance health status with agents and consumers",status:"backlog",created:"2026-02-26T00:00:00.000Z",updated:"2026-02-26T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Extract GitHub org config into dedicated repo",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-25-github-org-config-repo"},next:{title:"Kubernetes and systemd inspired patterns",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-26-kubernetes-systemd-patterns"}},c={},l=[{value:"Objective",id:"objective",level:2},{value:"Changes",id:"changes",level:2},{value:"Show registered agents",id:"show-registered-agents",level:3},{value:"Show registry bucket in KV Buckets table",id:"show-registry-bucket-in-kv-buckets-table",level:3},{value:"Show consumers (stretch)",id:"show-consumers-stretch",level:3},{value:"Progress",id:"progress",level:2},{value:"Notes",id:"notes",level:2}];function d(e){const t={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"objective",children:"Objective"}),"\n",(0,n.jsxs)(t.p,{children:["Enrich the ",(0,n.jsx)(t.code,{children:"client health status"})," output with agent registry and consumer\ninformation so operators get a complete operational overview from a single\ncommand."]}),"\n",(0,n.jsx)(t.h2,{id:"changes",children:"Changes"}),"\n",(0,n.jsx)(t.h3,{id:"show-registered-agents",children:"Show registered agents"}),"\n",(0,n.jsxs)(t.p,{children:["Read the ",(0,n.jsx)(t.code,{children:"agent-registry"})," KV bucket and display an Agents section:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"  Agents: 3 registered\n\n  HOSTNAME  LABELS          REGISTERED\n  web-01    group=web.prod  15s ago\n  web-02    group=web.prod  8s ago\n  db-01     group=db        2m ago\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The registry KV bucket uses a 30s TTL, so only live agents appear. The\n",(0,n.jsx)(t.code,{children:"REGISTERED"})," column shows the age of ",(0,n.jsx)(t.code,{children:"registered_at"})," from the\n",(0,n.jsx)(t.code,{children:"AgentRegistration"})," entry."]}),"\n",(0,n.jsx)(t.h3,{id:"show-registry-bucket-in-kv-buckets-table",children:"Show registry bucket in KV Buckets table"}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"agent-registry"})," bucket should appear alongside ",(0,n.jsx)(t.code,{children:"job-queue"})," in the existing\nKV Buckets table. Investigate why it currently does not \u2014 the health endpoint\nmay be filtering to specific bucket names rather than listing all buckets."]}),"\n",(0,n.jsx)(t.h3,{id:"show-consumers-stretch",children:"Show consumers (stretch)"}),"\n",(0,n.jsx)(t.p,{children:"Add a Consumers section showing JetStream consumer details per stream. This\nwould help operators see which agents have active subscriptions and whether\nconsumers are lagging:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"  Consumers (osapi-JOBS):\n\n  NAME                 PENDING  ACKED\n  query_any_web_01     0        142\n  query_direct_web_01  0        38\n  modify_any_web_01    1        15\n"})}),"\n",(0,n.jsx)(t.p,{children:"This is lower priority \u2014 the agent list covers the main operational need.\nConsumer details are useful for debugging but may be noisy with many agents."}),"\n",(0,n.jsx)(t.h2,{id:"progress",children:"Progress"}),"\n",(0,n.jsxs)(t.p,{children:["The agent summary line (",(0,n.jsx)(t.code,{children:"Agents: 2 total, 2 ready"}),") was implemented as part of\nthe heartbeat enrichment work (Phase 5). The ",(0,n.jsx)(t.code,{children:"AgentStats"})," schema and\n",(0,n.jsx)(t.code,{children:"GetAgentStats"})," provider are wired in. What remains:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Per-agent table in health status output (hostname, labels, registered)"}),"\n",(0,n.jsx)(t.li,{children:"Registry bucket visibility in KV Buckets section"}),"\n",(0,n.jsx)(t.li,{children:"Consumer details (stretch)"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"notes",children:"Notes"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"The health status API response schema will need new fields for the per-agent\nlist and optionally consumers"}),"\n",(0,n.jsx)(t.li,{children:"The SDK and CLI will need updates to render the new sections"}),"\n",(0,n.jsxs)(t.li,{children:["Consider adding a ",(0,n.jsx)(t.code,{children:"--verbose"})," flag to show consumers only when requested"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453(e,t,s){s.d(t,{R:()=>i,x:()=>o});var n=s(96540);const r={},a=n.createContext(r);function i(e){const t=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);