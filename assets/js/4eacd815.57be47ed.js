"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8956],{23825(e,n,t){t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>o});var s=t(74848),i=t(28453);const d={title:"Migrate client job commands from direct NATS to REST API",status:"done",created:new Date("2026-02-17T00:00:00.000Z"),updated:new Date("2026-02-17T00:00:00.000Z"),completed:new Date("2026-02-17T00:00:00.000Z")},c=void 0,l={id:"sidebar/development/tasks/done/2026-02-17-refactor-migrate-client-job-to-rest-api",title:"Migrate client job commands from direct NATS to REST API",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-17-refactor-migrate-client-job-to-rest-api.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-17-refactor-migrate-client-job-to-rest-api",permalink:"/osapi/sidebar/development/tasks/done/2026-02-17-refactor-migrate-client-job-to-rest-api",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Migrate client job commands from direct NATS to REST API",status:"done",created:"2026-02-17T00:00:00.000Z",updated:"2026-02-17T00:00:00.000Z",completed:"2026-02-17T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Complete API input validation hardening",permalink:"/osapi/sidebar/development/tasks/done/2026-02-17-fix-api-input-validation-hardening"},next:{title:"Rename cmd/util_*.go files to descriptive names",permalink:"/osapi/sidebar/development/tasks/done/2026-02-17-refactor-rename-util-validate"}},r={},o=[{value:"Objective",id:"objective",level:2},{value:"Benefits",id:"benefits",level:2},{value:"Commands to Migrate",id:"commands-to-migrate",level:2},{value:"Tasks",id:"tasks",level:2},{value:"Notes",id:"notes",level:2}];function a(e){const n={code:"code",h2:"h2",input:"input",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,s.jsxs)(n.p,{children:["All ",(0,s.jsx)(n.code,{children:"client job"})," CLI commands currently bypass the REST API and connect directly\nto NATS. This is inconsistent with ",(0,s.jsx)(n.code,{children:"client system"})," and ",(0,s.jsx)(n.code,{children:"client network"}),", which\ngo through the REST API. Everything under ",(0,s.jsx)(n.code,{children:"client"})," should use the same path: CLI\n\u2192 REST API \u2192 NATS."]}),"\n",(0,s.jsx)(n.p,{children:"Current state:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"client system *   \u2192 REST API \u2192 NATS    (correct)\nclient network *  \u2192 REST API \u2192 NATS    (correct)\nclient job *      \u2192 NATS directly      (inconsistent)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Target state:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"client *          \u2192 REST API \u2192 NATS    (all consistent)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"benefits",children:"Benefits"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"One entry point (API URL) \u2014 no NATS host/port needed in CLI"}),"\n",(0,s.jsx)(n.li,{children:"Auth/middleware applies uniformly"}),"\n",(0,s.jsx)(n.li,{children:"CLI doesn't need NATS credentials"}),"\n",(0,s.jsx)(n.li,{children:"Can put load balancer/proxy in front of the API"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"commands-to-migrate",children:"Commands to Migrate"}),"\n",(0,s.jsx)(n.p,{children:"All REST API endpoints already exist:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"CLI Command"}),(0,s.jsx)(n.th,{children:"Current Path"}),(0,s.jsx)(n.th,{children:"REST Endpoint"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client job add"})}),(0,s.jsx)(n.td,{children:"Direct NATS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /job"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client job list"})}),(0,s.jsx)(n.td,{children:"Direct NATS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET /job"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client job get"})}),(0,s.jsx)(n.td,{children:"Direct NATS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET /job/{id}"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client job delete"})}),(0,s.jsx)(n.td,{children:"Direct NATS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DELETE /job/{id}"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client job status"})}),(0,s.jsx)(n.td,{children:"Direct NATS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET /job/status"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client job run"})}),(0,s.jsx)(n.td,{children:"Direct NATS"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"POST /job"})," + poll ",(0,s.jsx)(n.code,{children:"GET /job/{id}"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client job workers list"})}),(0,s.jsx)(n.td,{children:"Direct NATS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET /job/workers"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"tasks",children:"Tasks"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," Rewrite each command to use the REST client (",(0,s.jsx)(n.code,{children:"handler"}),") instead of\n",(0,s.jsx)(n.code,{children:"jobClient"})]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," Remove NATS setup from ",(0,s.jsx)(n.code,{children:"client_job.go"})," ",(0,s.jsx)(n.code,{children:"PersistentPreRun"})]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," Remove ",(0,s.jsx)(n.code,{children:"natsClient"}),", ",(0,s.jsx)(n.code,{children:"jobsKV"}),", ",(0,s.jsx)(n.code,{children:"jobClient"})," package vars"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," Remove NATS-related flags from ",(0,s.jsx)(n.code,{children:"client_job.go"})," (nats-host, nats-port,\nkv-bucket, stream-name, etc.)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," Add any missing REST client handler methods if needed"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," Update tests"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," Verify ",(0,s.jsx)(n.code,{children:"client job run"})," polling works through REST API"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The generated REST client (",(0,s.jsx)(n.code,{children:"internal/client/gen/client.gen.go"}),") already has\nmethods for all endpoints."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"client"})," parent command already creates the REST client in its\n",(0,s.jsx)(n.code,{children:"PersistentPreRun"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"client job run"})," is the most complex \u2014 it creates a job then polls for\ncompletion. This maps to ",(0,s.jsx)(n.code,{children:"POST /job"})," followed by polling ",(0,s.jsx)(n.code,{children:"GET /job/{id}"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453(e,n,t){t.d(n,{R:()=>c,x:()=>l});var s=t(96540);const i={},d=s.createContext(i);function c(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);