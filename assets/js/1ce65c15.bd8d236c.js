"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3252],{47005(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var s=n(74848),r=n(28453);const a={title:"Enhance health status with agents and consumers",status:"done",created:new Date("2026-02-26T00:00:00.000Z"),updated:new Date("2026-02-27T00:00:00.000Z")},i=void 0,o={id:"sidebar/development/tasks/done/2026-02-26-feat-health-status-enhancements",title:"Enhance health status with agents and consumers",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-26-feat-health-status-enhancements.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-26-feat-health-status-enhancements",permalink:"/osapi/sidebar/development/tasks/done/2026-02-26-feat-health-status-enhancements",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Enhance health status with agents and consumers",status:"done",created:"2026-02-26T00:00:00.000Z",updated:"2026-02-27T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"CLI taxonomy reorganization",permalink:"/osapi/sidebar/development/tasks/done/2026-02-26-cli-taxonomy-reorganization"},next:{title:"Replace box-drawing tables with compact kubectl-style columns",permalink:"/osapi/sidebar/development/tasks/done/2026-02-26-refactor-compact-table-output"}},c={},d=[{value:"Objective",id:"objective",level:2},{value:"Changes",id:"changes",level:2},{value:"Show registered agents",id:"show-registered-agents",level:3},{value:"Show registry bucket in KV Buckets table",id:"show-registry-bucket-in-kv-buckets-table",level:3},{value:"Show consumers (stretch)",id:"show-consumers-stretch",level:3},{value:"Progress",id:"progress",level:2},{value:"Outcome",id:"outcome",level:2}];function l(e){const t={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"objective",children:"Objective"}),"\n",(0,s.jsxs)(t.p,{children:["Enrich the ",(0,s.jsx)(t.code,{children:"client health status"})," output with agent registry and consumer\ninformation so operators get a complete operational overview from a single\ncommand."]}),"\n",(0,s.jsx)(t.h2,{id:"changes",children:"Changes"}),"\n",(0,s.jsx)(t.h3,{id:"show-registered-agents",children:"Show registered agents"}),"\n",(0,s.jsxs)(t.p,{children:["Read the ",(0,s.jsx)(t.code,{children:"agent-registry"})," KV bucket and display an Agents section:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"  Agents: 3 registered\n\n  HOSTNAME  LABELS          REGISTERED\n  web-01    group=web.prod  15s ago\n  web-02    group=web.prod  8s ago\n  db-01     group=db        2m ago\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The registry KV bucket uses a 30s TTL, so only live agents appear. The\n",(0,s.jsx)(t.code,{children:"REGISTERED"})," column shows the age of ",(0,s.jsx)(t.code,{children:"registered_at"})," from the\n",(0,s.jsx)(t.code,{children:"AgentRegistration"})," entry."]}),"\n",(0,s.jsx)(t.h3,{id:"show-registry-bucket-in-kv-buckets-table",children:"Show registry bucket in KV Buckets table"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"agent-registry"})," bucket should appear alongside ",(0,s.jsx)(t.code,{children:"job-queue"})," in the existing\nKV Buckets table. Investigate why it currently does not \u2014 the health endpoint\nmay be filtering to specific bucket names rather than listing all buckets."]}),"\n",(0,s.jsx)(t.h3,{id:"show-consumers-stretch",children:"Show consumers (stretch)"}),"\n",(0,s.jsx)(t.p,{children:"Add a Consumers section showing JetStream consumer details per stream. This\nwould help operators see which agents have active subscriptions and whether\nconsumers are lagging:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"  Consumers (osapi-JOBS):\n\n  NAME                 PENDING  ACKED\n  query_any_web_01     0        142\n  query_direct_web_01  0        38\n  modify_any_web_01    1        15\n"})}),"\n",(0,s.jsx)(t.p,{children:"This is lower priority \u2014 the agent list covers the main operational need.\nConsumer details are useful for debugging but may be noisy with many agents."}),"\n",(0,s.jsx)(t.h2,{id:"progress",children:"Progress"}),"\n",(0,s.jsxs)(t.p,{children:["The agent summary line (",(0,s.jsx)(t.code,{children:"Agents: 2 total, 2 ready"}),") was implemented as part of\nthe heartbeat enrichment work (Phase 5). The ",(0,s.jsx)(t.code,{children:"AgentStats"})," schema and\n",(0,s.jsx)(t.code,{children:"GetAgentStats"})," provider are wired in."]}),"\n",(0,s.jsx)(t.p,{children:"Completed:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Per-agent table in health status output (hostname, labels, registered)"}),"\n",(0,s.jsx)(t.li,{children:"Registry bucket visibility in KV Buckets section"}),"\n",(0,s.jsx)(t.li,{children:"Per-consumer details (name, pending, ack_pending, redelivered)"}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"AgentDetail"})," and ",(0,s.jsx)(t.code,{children:"ConsumerDetail"})," OpenAPI schemas added"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"ConsumerStatsFn"})," uses ",(0,s.jsx)(t.code,{children:"stream.ListConsumers()"})," for real data"]}),"\n",(0,s.jsxs)(t.li,{children:["CLI renders tables with ",(0,s.jsx)(t.code,{children:"PrintCompactTable"})]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"outcome",children:"Outcome"}),"\n",(0,s.jsxs)(t.p,{children:["All items completed including the stretch goal (per-consumer details). Also\nadded ",(0,s.jsx)(t.code,{children:"GetQueueSummary()"})," key-name-only fast path and concurrent metrics\nfetching, reducing health status response from ~15s to ~600ms."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453(e,t,n){n.d(t,{R:()=>i,x:()=>o});var s=n(96540);const r={},a=s.createContext(r);function i(e){const t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);