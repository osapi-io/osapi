"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5398],{86717(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=s(74848),r=s(28453);const i={sidebar_position:1,sidebar_label:"Overview"},a="Architecture",o={id:"sidebar/architecture/architecture",title:"Architecture",description:"OSAPI turns Linux servers into managed appliances. You install a single binary,",source:"@site/docs/sidebar/architecture/architecture.md",sourceDirName:"sidebar/architecture",slug:"/sidebar/architecture/",permalink:"/osapi/sidebar/architecture/",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Overview"},sidebar:"testSidebar",previous:{title:"Metrics",permalink:"/osapi/sidebar/features/metrics"},next:{title:"System Architecture",permalink:"/osapi/sidebar/architecture/system-architecture"}},l={},d=[{value:"The Three Processes",id:"the-three-processes",level:2},{value:"NATS Server",id:"nats-server",level:3},{value:"API Server",id:"api-server",level:3},{value:"Agent",id:"agent",level:3},{value:"Deployment Models",id:"deployment-models",level:2},{value:"Single Host",id:"single-host",level:3},{value:"Multi-Host",id:"multi-host",level:3},{value:"How a Request Flows",id:"how-a-request-flows",level:2},{value:"Further Reading",id:"further-reading",level:2},{value:"Deep Dives",id:"deep-dives",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,t.jsx)(n.p,{children:"OSAPI turns Linux servers into managed appliances. You install a single binary,\npoint it at a config file, and get a REST API and CLI for querying and changing\nsystem configuration \u2014 hostname, DNS, disk usage, memory, load averages, and\nmore. State-changing operations run asynchronously through a job queue so the\nAPI server itself never needs root privileges."}),"\n",(0,t.jsx)(n.h2,{id:"the-three-processes",children:"The Three Processes"}),"\n",(0,t.jsx)(n.p,{children:"OSAPI has three runtime components. They can all run on the same host or be\nspread across many."}),"\n",(0,t.jsx)(n.h3,{id:"nats-server",children:"NATS Server"}),"\n",(0,t.jsxs)(n.p,{children:["A lightweight message broker that stores job state and routes messages between\nthe API server and agents. OSAPI embeds a NATS server with JetStream enabled, so\nyou don't need to install anything extra \u2014 just run ",(0,t.jsx)(n.code,{children:"osapi nats server start"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["For production deployments with multiple hosts, you can point everything at an\nexternal NATS cluster instead of the embedded one. Just change the ",(0,t.jsx)(n.code,{children:"nats.server"}),"\nsection in ",(0,t.jsx)(n.code,{children:"osapi.yaml"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"api-server",children:"API Server"}),"\n",(0,t.jsx)(n.p,{children:"An HTTP server that exposes a REST API. It handles authentication (JWT),\nvalidates requests, and translates them into jobs that get published to NATS.\nThe API server never executes system commands directly \u2014 it creates a job and\nreturns a job ID. Clients poll for results."}),"\n",(0,t.jsxs)(n.p,{children:["Start it with ",(0,t.jsx)(n.code,{children:"osapi api server start"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"agent",children:"Agent"}),"\n",(0,t.jsx)(n.p,{children:"A background process that subscribes to NATS, picks up jobs, and executes the\nactual system operations (reading hostname, querying DNS, checking disk usage,\netc.). Agents run with whatever privileges they have \u2014 if an agent can't read\nsomething due to permissions, it reports the error rather than failing silently."}),"\n",(0,t.jsxs)(n.p,{children:["Start it with ",(0,t.jsx)(n.code,{children:"osapi agent start"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"deployment-models",children:"Deployment Models"}),"\n",(0,t.jsx)(n.h3,{id:"single-host",children:"Single Host"}),"\n",(0,t.jsx)(n.p,{children:"The simplest setup. All three processes run on the same machine:"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TD\n    subgraph host["Linux Host"]\n        CLI["CLI"]\n        API["API Server"]\n        Agent["Agent"]\n        NATS["NATS (embedded)"]\n\n        CLI --\x3e|HTTP| API\n        API --\x3e|publish job| NATS\n        NATS --\x3e|deliver job| Agent\n        Agent --\x3e|write result| NATS\n        API --\x3e|read result| NATS\n    end'}),"\n",(0,t.jsx)(n.p,{children:"The CLI on the same host talks to the API server over localhost. This is useful\nfor managing a single appliance or for development."}),"\n",(0,t.jsx)(n.h3,{id:"multi-host",children:"Multi-Host"}),"\n",(0,t.jsx)(n.p,{children:"For managing a fleet, run a shared NATS server (or cluster) and point multiple\nagents at it. Each agent registers with its hostname and optional labels, and\nthe job routing system delivers work to the right place."}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TD\n    CLI["CLI"]\n    API["API Server"]\n    NATS["NATS (shared)"]\n    W1["Agent (web-01)"]\n    W2["Agent (web-02)"]\n\n    CLI --\x3e|HTTP| API\n    API --\x3e|publish job| NATS\n    NATS --\x3e|deliver job| W1\n    NATS --\x3e|deliver job| W2\n    W1 --\x3e|write result| NATS\n    W2 --\x3e|write result| NATS\n    API --\x3e|read result| NATS'}),"\n",(0,t.jsx)(n.p,{children:"You can target jobs to specific hosts, broadcast to all, or route by label:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"--target _any"})," \u2014 send to any available agent (load balanced)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"--target _all"})," \u2014 send to every agent (broadcast)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"--target web-01"})," \u2014 send to a specific host"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"--target group:web.dev"})," \u2014 send to all agents with a matching label"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"how-a-request-flows",children:"How a Request Flows"}),"\n",(0,t.jsxs)(n.p,{children:["When you run a command like ",(0,t.jsx)(n.code,{children:"osapi client node hostname"}),":"]}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant CLI\n    participant API as API Server\n    participant NATS\n    participant Agent\n\n    CLI->>API: POST /api/v1/jobs\n    API->>NATS: store job in KV\n    API->>NATS: publish notification\n    API--\x3e>CLI: 201 (job_id)\n    NATS->>Agent: deliver notification\n    Agent->>NATS: read job from KV\n    Agent->>Agent: execute operation\n    Agent->>NATS: write result to KV\n    CLI->>API: GET /api/v1/jobs/{id}\n    API->>NATS: read result from KV\n    API--\x3e>CLI: 200 (result)"}),"\n",(0,t.jsx)(n.p,{children:"The API server never touches the operating system directly. It's a thin\ncoordination layer between clients and agents."}),"\n",(0,t.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,t.jsx)(n.p,{children:"For details on individual features \u2014 what they do, how they work, and how to\nconfigure them \u2014 see the Features section:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/node-management",children:"Node Management"})," \u2014 hostname, disk, memory,\nload"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/network-management",children:"Network Management"})," \u2014 DNS, ping"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/command-execution",children:"Command Execution"})," \u2014 exec, shell"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/job-system",children:"Job System"})," \u2014 async job processing and routing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/audit-logging",children:"Audit Logging"})," \u2014 API audit trail and export"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/health-checks",children:"Health Checks"})," \u2014 liveness, readiness, status"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/authentication",children:"Authentication & RBAC"})," \u2014 JWT, roles,\npermissions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/distributed-tracing",children:"Distributed Tracing"})," \u2014 OpenTelemetry\nintegration"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/features/metrics",children:"Metrics"})," \u2014 Prometheus endpoint"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"deep-dives",children:"Deep Dives"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/architecture/system-architecture",children:"System Architecture"})," \u2014 package layout, handler\nstructure, provider pattern, and code-level details"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/architecture/job-architecture",children:"Job Architecture"})," \u2014 KV-first design, subject routing,\nagent pipeline, and multi-host processing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/usage/configuration",children:"Configuration"})," \u2014 full ",(0,t.jsx)(n.code,{children:"osapi.yaml"})," reference with\nevery supported field"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/architecture/api-guidelines",children:"API Design Guidelines"})," \u2014 REST conventions and endpoint\npatterns"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/architecture/principles",children:"Guiding Principles"})," \u2014 design philosophy and project values"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/osapi/sidebar/development/",children:"Development"})," \u2014 setup, building, testing, and\ncontributing"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453(e,n,s){s.d(n,{R:()=>a,x:()=>o});var t=s(96540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);