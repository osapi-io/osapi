"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6221],{70831(e,s,t){t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});var n=t(74848),o=t(28453);const l={title:"Implement broadcast (_all) response collection",status:"done",created:new Date("2026-02-16T00:00:00.000Z"),updated:new Date("2026-02-17T00:00:00.000Z")},i=void 0,r={id:"sidebar/development/tasks/done/2026-02-16-feat-broadcast-response-collection",title:"Implement broadcast (_all) response collection",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-16-feat-broadcast-response-collection.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-16-feat-broadcast-response-collection",permalink:"/osapi/sidebar/development/tasks/done/2026-02-16-feat-broadcast-response-collection",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Implement broadcast (_all) response collection",status:"done",created:"2026-02-16T00:00:00.000Z",updated:"2026-02-17T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Verify multi-system routing and per-system response aggregation",permalink:"/osapi/sidebar/development/tasks/done/2026-02-15-test-verify-multi-system-routing"},next:{title:"Add Darwin development providers",permalink:"/osapi/sidebar/development/tasks/done/2026-02-16-feat-darwin-providers"}},c={},d=[{value:"Objective",id:"objective",level:2},{value:"Tasks",id:"tasks",level:2},{value:"Outcome",id:"outcome",level:2}];function a(e){const s={code:"code",h2:"h2",input:"input",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h2,{id:"objective",children:"Objective"}),"\n",(0,n.jsxs)(s.p,{children:["The multi-system routing verification (2026-02-15) confirmed that ",(0,n.jsx)(s.code,{children:"_all"}),"\nbroadcast routing works correctly at the NATS level, but three gaps exist in the\nresponse collection layer:"]}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsxs)(s.strong,{children:[(0,n.jsx)(s.code,{children:"QuerySystemStatusAll"})," is a stub"]})," \u2014 The job client method for querying all\nsystems' status is not yet implemented."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsxs)(s.strong,{children:[(0,n.jsx)(s.code,{children:"publishAndWait"})," collects only the first response"]})," \u2014 For ",(0,n.jsx)(s.code,{children:"_all"})," jobs, the\nclient needs to wait for and aggregate responses from multiple workers."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"REST API single-result schema"})," \u2014 ",(0,n.jsx)(s.code,{children:"GET /job/{id}"})," returns a single\n",(0,n.jsx)(s.code,{children:"hostname"}),"/",(0,n.jsx)(s.code,{children:"result"})," pair. For ",(0,n.jsx)(s.code,{children:"_all"})," jobs, the response should include\nper-worker results (list of hostname/result/status tuples)."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"tasks",children:"Tasks"}),"\n",(0,n.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(s.li,{className:"task-list-item",children:[(0,n.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," Implement ",(0,n.jsx)(s.code,{children:"QuerySystemStatusAll"})," in ",(0,n.jsx)(s.code,{children:"internal/job/client/query.go"})]}),"\n",(0,n.jsxs)(s.li,{className:"task-list-item",children:[(0,n.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," Create ",(0,n.jsx)(s.code,{children:"publishAndCollect"})," to gather multiple responses within a timeout\nwindow"]}),"\n",(0,n.jsxs)(s.li,{className:"task-list-item",children:[(0,n.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," Add ",(0,n.jsx)(s.code,{children:"responses"})," and ",(0,n.jsx)(s.code,{children:"worker_states"})," fields to ",(0,n.jsx)(s.code,{children:"JobDetailResponse"})," schema\nto return per-worker results for broadcast jobs"]}),"\n",(0,n.jsxs)(s.li,{className:"task-list-item",children:[(0,n.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," Add tests for multi-worker response aggregation"]}),"\n",(0,n.jsxs)(s.li,{className:"task-list-item",children:[(0,n.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," Fix ",(0,n.jsx)(s.code,{children:"GetJobStatus"})," hostname/result mapping gap"]}),"\n",(0,n.jsxs)(s.li,{className:"task-list-item",children:[(0,n.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," Add ",(0,n.jsx)(s.code,{children:"QuerySystemStatusAll"})," to ",(0,n.jsx)(s.code,{children:"JobClient"})," interface"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"outcome",children:"Outcome"}),"\n",(0,n.jsx)(s.p,{children:"All broadcast response collection gaps resolved:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"publishAndCollect()"})," method waits full timeout, collects all worker responses\ninto ",(0,n.jsx)(s.code,{children:"map[string]*job.Response"})," keyed by hostname"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"QuerySystemStatusAll()"})," uses ",(0,n.jsx)(s.code,{children:"publishAndCollect"})," with ",(0,n.jsx)(s.code,{children:"_all"})," subject"]}),"\n",(0,n.jsxs)(s.li,{children:["REST API ",(0,n.jsx)(s.code,{children:"GET /job/{id}"})," exposes ",(0,n.jsx)(s.code,{children:"responses"})," (per-worker results) and\n",(0,n.jsx)(s.code,{children:"worker_states"})," (per-worker state/duration) for broadcast jobs"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"GetJobStatus"})," now populates ",(0,n.jsx)(s.code,{children:"Hostname"})," from computed status and ",(0,n.jsx)(s.code,{children:"Result"})," from\nsingle-worker response"]}),"\n",(0,n.jsx)(s.li,{children:"All tests pass, zero lint issues"}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},28453(e,s,t){t.d(s,{R:()=>i,x:()=>r});var n=t(96540);const o={},l=n.createContext(o);function i(e){const s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(l.Provider,{value:s},e.children)}}}]);