"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[9851],{76644(e,n,i){i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>d,toc:()=>c});var t=i(74848),s=i(28453);const l={title:"Consistent debug logging across all components",status:"done",created:new Date("2026-02-19T00:00:00.000Z"),updated:new Date("2026-02-19T00:00:00.000Z")},o=void 0,d={id:"sidebar/development/tasks/done/2026-02-19-feat-consistent-debug-logging",title:"Consistent debug logging across all components",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-19-feat-consistent-debug-logging.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-19-feat-consistent-debug-logging",permalink:"/osapi/sidebar/development/tasks/done/2026-02-19-feat-consistent-debug-logging",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Consistent debug logging across all components",status:"done",created:"2026-02-19T00:00:00.000Z",updated:"2026-02-19T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Fix dotted hostname breaks NATS subject routing",permalink:"/osapi/sidebar/development/tasks/done/2026-02-18-fix-dotted-hostname-routing"},next:{title:"Rename health detailed to health status and enrich with system metrics",permalink:"/osapi/sidebar/development/tasks/done/2026-02-19-feat-health-status"}},r={},c=[{value:"Objective",id:"objective",level:2},{value:"Scope",id:"scope",level:2},{value:"HTTP Client Layer (<code>internal/client/</code>)",id:"http-client-layer-internalclient",level:3},{value:"NATS Client (<code>nats-client</code> sibling repo)",id:"nats-client-nats-client-sibling-repo",level:3},{value:"API Handlers (<code>internal/api/</code>)",id:"api-handlers-internalapi",level:3},{value:"Job Client (<code>internal/job/client/</code>)",id:"job-client-internaljobclient",level:3},{value:"Worker (<code>internal/job/worker/</code>)",id:"worker-internaljobworker",level:3},{value:"CLI Commands (<code>cmd/</code>)",id:"cli-commands-cmd",level:3},{value:"Standardized Attributes",id:"standardized-attributes",level:3},{value:"Notes",id:"notes",level:2},{value:"Outcome",id:"outcome",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,t.jsxs)(n.p,{children:["Make ",(0,t.jsx)(n.code,{children:"--debug"})," output useful and consistent across every component in the\nplatform. Currently, logging is sparse and inconsistent: the HTTP client layer\nhas zero request/response logging, NATS KV operations are silent, API handlers\nrely entirely on slog-echo middleware with no domain-level logging, and\nproviders only log warnings for permission issues. This task standardizes\ndebug-level logging so that running with ",(0,t.jsx)(n.code,{children:"--debug"})," produces a coherent, readable\ntrace of what the system is doing."]}),"\n",(0,t.jsx)(n.h2,{id:"scope",children:"Scope"}),"\n",(0,t.jsxs)(n.h3,{id:"http-client-layer-internalclient",children:["HTTP Client Layer (",(0,t.jsx)(n.code,{children:"internal/client/"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Log request method, URL, and response status on every call"}),"\n",(0,t.jsx)(n.li,{children:"Log request duration at debug level"}),"\n",(0,t.jsx)(n.li,{children:"Log error responses with body summary"}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"nats-client-nats-client-sibling-repo",children:["NATS Client (",(0,t.jsx)(n.code,{children:"nats-client"})," sibling repo)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Log individual KV Get/Put/Delete operations with bucket and key"}),"\n",(0,t.jsx)(n.li,{children:"Log stream Publish with subject"}),"\n",(0,t.jsx)(n.li,{children:"Log connection events (connect, reconnect, disconnect)"}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"api-handlers-internalapi",children:["API Handlers (",(0,t.jsx)(n.code,{children:"internal/api/"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Add debug-level log on handler entry with operation name"}),"\n",(0,t.jsx)(n.li,{children:"Log operation completion with duration"}),"\n",(0,t.jsx)(n.li,{children:"Use the request logger from echo context"}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"job-client-internaljobclient",children:["Job Client (",(0,t.jsx)(n.code,{children:"internal/job/client/"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Log all KV reads and writes with job ID and operation"}),"\n",(0,t.jsx)(n.li,{children:"Log notification publishes with subject"}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"worker-internaljobworker",children:["Worker (",(0,t.jsx)(n.code,{children:"internal/job/worker/"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Log provider execution start/finish with operation and duration"}),"\n",(0,t.jsx)(n.li,{children:"Log result writes to KV"}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"cli-commands-cmd",children:["CLI Commands (",(0,t.jsx)(n.code,{children:"cmd/"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Consistent debug logging pattern for all client commands"}),"\n",(0,t.jsx)(n.li,{children:"Log the endpoint being called and response status"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"standardized-attributes",children:"Standardized Attributes"}),"\n",(0,t.jsx)(n.p,{children:"Define a common set of slog attributes used everywhere:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"component"})," \u2014 which subsystem (api, worker, client, nats)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"operation"})," \u2014 what action (kv.get, kv.put, http.request, etc.)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"job_id"})," \u2014 when operating on a job"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"duration"})," \u2014 for timed operations"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["All new logging should be at ",(0,t.jsx)(n.code,{children:"slog.LevelDebug"})," so it only appears when\n",(0,t.jsx)(n.code,{children:"--debug"})," is enabled"]}),"\n",(0,t.jsx)(n.li,{children:"Follow existing slog patterns in the codebase (structured key-value)"}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"nats-client"})," repo changes need to be coordinated since it's a sibling\nmodule linked via ",(0,t.jsx)(n.code,{children:"replace"})," in ",(0,t.jsx)(n.code,{children:"go.mod"})]}),"\n",(0,t.jsx)(n.li,{children:"Avoid logging sensitive data (tokens, signing keys)"}),"\n",(0,t.jsx)(n.li,{children:"Keep log lines concise \u2014 one line per operation, not multi-line dumps"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"outcome",children:"Outcome"}),"\n",(0,t.jsx)(n.p,{children:"Implemented across 49 files in 4 phases:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"HTTP client transport logging with method, URL, status, and duration"}),"\n",(0,t.jsx)(n.li,{children:"NATS KV operation logging (get, put, keys, delete)"}),"\n",(0,t.jsx)(n.li,{children:"Worker processor dispatch logging (category, operation, provider)"}),"\n",(0,t.jsx)(n.li,{children:"API handler domain-context logging (routing, job IDs, interfaces)"}),"\n",(0,t.jsx)(n.li,{children:"Fixed bug: health_status_get.go used package-level slog instead of injected\nlogger"}),"\n",(0,t.jsxs)(n.li,{children:["All logging is Debug-level, invisible unless ",(0,t.jsx)(n.code,{children:"--debug"})," is set"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453(e,n,i){i.d(n,{R:()=>o,x:()=>d});var t=i(96540);const s={},l=t.createContext(s);function o(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);