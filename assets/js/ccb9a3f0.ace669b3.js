"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6644],{33433(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>a});var s=n(74848),o=n(28453);const i={title:"Fix dotted hostname breaks NATS subject routing",status:"done",created:new Date("2026-02-18T00:00:00.000Z"),updated:new Date("2026-02-18T00:00:00.000Z")},d=void 0,r={id:"sidebar/development/tasks/done/2026-02-18-fix-dotted-hostname-routing",title:"Fix dotted hostname breaks NATS subject routing",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-18-fix-dotted-hostname-routing.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-18-fix-dotted-hostname-routing",permalink:"/osapi/sidebar/development/tasks/done/2026-02-18-fix-dotted-hostname-routing",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Fix dotted hostname breaks NATS subject routing",status:"done",created:"2026-02-18T00:00:00.000Z",updated:"2026-02-18T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Add configuration reference documentation",permalink:"/osapi/sidebar/development/tasks/done/2026-02-18-docs-configuration-reference"},next:{title:"Consistent debug logging across all components",permalink:"/osapi/sidebar/development/tasks/done/2026-02-19-feat-consistent-debug-logging"}},c={},a=[{value:"Objective",id:"objective",level:2},{value:"Problem",id:"problem",level:2},{value:"Affected Code",id:"affected-code",level:2},{value:"Suggested Fix",id:"suggested-fix",level:2},{value:"Notes",id:"notes",level:2}];function l(e){const t={code:"code",h2:"h2",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"objective",children:"Objective"}),"\n",(0,s.jsxs)(t.p,{children:["Hostnames containing dots (e.g., ",(0,s.jsx)(t.code,{children:"Johns-MacBook-Pro-2.local"}),") break NATS subject\nrouting because dots are NATS subject delimiters."]}),"\n",(0,s.jsx)(t.h2,{id:"problem",children:"Problem"}),"\n",(0,s.jsxs)(t.p,{children:["When targeting a host with dots in the name, ",(0,s.jsx)(t.code,{children:"BuildSubjectFromTarget"})," produces a\nsubject like ",(0,s.jsx)(t.code,{children:"jobs.query.host.Johns-MacBook-Pro-2.local"})," (6 tokens). The worker\nsubscribes using ",(0,s.jsx)(t.code,{children:"SanitizeHostname"}),", which replaces dots with underscores:\n",(0,s.jsx)(t.code,{children:"jobs.*.host.Johns-MacBook-Pro-2_local"})," (4 tokens). The subjects never match, so\nthe job is never delivered."]}),"\n",(0,s.jsx)(t.h2,{id:"affected-code",children:"Affected Code"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"internal/job/subjects.go"})," \u2014 ",(0,s.jsx)(t.code,{children:"BuildSubjectFromTarget"})," (line 241) builds the\npublish subject without sanitizing the hostname"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"internal/job/subjects.go"})," \u2014 ",(0,s.jsx)(t.code,{children:"BuildWorkerSubscriptionPattern"})," (line 148)\nsanitizes via ",(0,s.jsx)(t.code,{children:"SanitizeHostname"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"internal/job/subjects.go"})," \u2014 ",(0,s.jsx)(t.code,{children:"ParseSubject"})," (line 113) would also need to\nhandle sanitized hostnames on the parse side"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"suggested-fix",children:"Suggested Fix"}),"\n",(0,s.jsxs)(t.p,{children:["Sanitize the hostname in ",(0,s.jsx)(t.code,{children:"BuildSubjectFromTarget"})," for the ",(0,s.jsx)(t.code,{children:'"host"'})," case so the\npublish subject matches the worker subscription. Ensure ",(0,s.jsx)(t.code,{children:"ParseSubject"}),"\nround-trips correctly with sanitized hostnames. Add test cases for dotted\nhostnames."]}),"\n",(0,s.jsx)(t.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Reproduced with:\n",(0,s.jsx)(t.code,{children:"go run main.go client network dns get --interface-name eth0 --target 'Johns-MacBook-Pro-2.local'"})]}),"\n",(0,s.jsx)(t.li,{children:"The job is created but no worker ever picks it up."}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453(e,t,n){n.d(t,{R:()=>d,x:()=>r});var s=n(96540);const o={},i=s.createContext(o);function d(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);