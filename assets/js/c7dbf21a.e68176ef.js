"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3933],{46899(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>a,frontMatter:()=>t,metadata:()=>c,toc:()=>h});var r=s(74848),i=s(28453);const t={sidebar_position:2},d="System Architecture",c={id:"sidebar/architecture/system-architecture",title:"System Architecture",description:"OSAPI is a Linux system management platform that exposes a REST API for querying",source:"@site/docs/sidebar/architecture/system-architecture.md",sourceDirName:"sidebar/architecture",slug:"/sidebar/architecture/system-architecture",permalink:"/osapi/sidebar/architecture/system-architecture",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"testSidebar",previous:{title:"Overview",permalink:"/osapi/sidebar/architecture/"},next:{title:"Job System Architecture",permalink:"/osapi/sidebar/architecture/job-architecture"}},l={},h=[{value:"Component Map",id:"component-map",level:2},{value:"Entry Points",id:"entry-points",level:2},{value:"Layers",id:"layers",level:2},{value:"CLI (<code>cmd/</code>)",id:"cli-cmd",level:3},{value:"REST API (<code>internal/api/</code>)",id:"rest-api-internalapi",level:3},{value:"Job System (<code>internal/job/</code>)",id:"job-system-internaljob",level:3},{value:"Provider Layer (<code>internal/provider/</code>)",id:"provider-layer-internalprovider",level:3},{value:"Configuration (<code>internal/config/</code>)",id:"configuration-internalconfig",level:3},{value:"Health Checks (<code>internal/api/health/</code>)",id:"health-checks-internalapihealth",level:2},{value:"Liveness (<code>/health</code>)",id:"liveness-health",level:3},{value:"Readiness (<code>/health/ready</code>)",id:"readiness-healthready",level:3},{value:"Status (<code>/health/status</code>)",id:"status-healthstatus",level:3},{value:"CLI Access",id:"cli-access",level:3},{value:"Request Flow",id:"request-flow",level:2},{value:"Security",id:"security",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Authorization",id:"authorization",level:3},{value:"CORS",id:"cors",level:3},{value:"External Dependencies",id:"external-dependencies",level:2},{value:"Further Reading",id:"further-reading",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"system-architecture",children:"System Architecture"})}),"\n",(0,r.jsx)(n.p,{children:"OSAPI is a Linux system management platform that exposes a REST API for querying\nand modifying host configuration and uses NATS JetStream for distributed,\nasynchronous job processing. Operators interact with the system through a CLI\nthat can either hit the REST API directly or manage the job queue."}),"\n",(0,r.jsx)(n.h2,{id:"component-map",children:"Component Map"}),"\n",(0,r.jsx)(n.p,{children:"The system is organized into six layers, top to bottom:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Layer"}),(0,r.jsx)(n.th,{children:"Package"}),(0,r.jsx)(n.th,{children:"Role"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"CLI"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"cmd/"})}),(0,r.jsx)(n.td,{children:"Cobra command tree (thin wiring)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Generated HTTP Client"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/client/"})}),(0,r.jsx)(n.td,{children:"OpenAPI-generated client used by CLI"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"REST API"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/api/"})}),(0,r.jsx)(n.td,{children:"Echo server with JWT middleware"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Job Client"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/job/client/"})}),(0,r.jsx)(n.td,{children:"Business logic for job CRUD and status"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"NATS JetStream"})}),(0,r.jsx)(n.td,{children:"(external)"}),(0,r.jsxs)(n.td,{children:["KV ",(0,r.jsx)(n.code,{children:"job-queue"}),", Stream ",(0,r.jsx)(n.code,{children:"JOBS"}),", KV ",(0,r.jsx)(n.code,{children:"job-responses"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Job Worker / Provider Layer"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"internal/job/worker/"}),", ",(0,r.jsx)(n.code,{children:"internal/provider/"})]}),(0,r.jsx)(n.td,{children:"Consumes jobs from NATS and executes providers"})]})]})]}),"\n",(0,r.jsx)(n.mermaid,{value:'graph TD\n    CLI["CLI (cmd/)"] --\x3e Client["Generated HTTP Client (internal/client/)"]\n    Client --\x3e API["REST API (internal/api/)"]\n    API --\x3e JobClient["Job Client (internal/job/client/)"]\n    JobClient --\x3e NATS["NATS JetStream"]\n    NATS --\x3e Worker["Job Worker (internal/job/worker/)"]\n    Worker --\x3e Provider["Provider Layer (internal/provider/)"]'}),"\n",(0,r.jsx)(n.p,{children:"The CLI talks to the REST API through the generated HTTP client. The REST API\ndelegates state-changing operations to the job client, which stores jobs in NATS\nKV and publishes notifications to the JOBS stream. Workers pick up\nnotifications, execute the matching provider, and write results back to KV."}),"\n",(0,r.jsx)(n.h2,{id:"entry-points",children:"Entry Points"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"osapi"})," binary exposes four top-level command groups:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"osapi api server start"})})," \u2014 starts the REST API server (Echo + JWT\nmiddleware)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"osapi job worker start"})})," \u2014 starts a job worker that subscribes to NATS\nsubjects and processes operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"osapi nats server start"})})," \u2014 starts an embedded NATS server with JetStream\nenabled"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"osapi client"})})," \u2014 CLI client that talks to the REST API (system, network,\njob, and health subcommands)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"layers",children:"Layers"}),"\n",(0,r.jsxs)(n.h3,{id:"cli-cmd",children:["CLI (",(0,r.jsx)(n.code,{children:"cmd/"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["The CLI is a ",(0,r.jsx)(n.a,{href:"https://github.com/spf13/cobra",children:"Cobra"})," command tree. Each file maps to a single command (e.g.,\n",(0,r.jsx)(n.code,{children:"client_job_add.go"})," implements ",(0,r.jsx)(n.code,{children:"osapi client job add"}),"). The CLI layer is thin\nwiring: it parses flags, reads config via Viper, and delegates to the\nappropriate internal package."]}),"\n",(0,r.jsxs)(n.h3,{id:"rest-api-internalapi",children:["REST API (",(0,r.jsx)(n.code,{children:"internal/api/"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["The API server is built on ",(0,r.jsx)(n.a,{href:"https://echo.labstack.com",children:"Echo"})," with handlers generated from an OpenAPI spec\nvia ",(0,r.jsx)(n.a,{href:"https://github.com/oapi-codegen/oapi-codegen",children:"oapi-codegen"})," (",(0,r.jsx)(n.code,{children:"*.gen.go"})," files). Domain handlers are organized into\nsubpackages:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Package"}),(0,r.jsx)(n.th,{children:"Responsibility"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/api/system/"})}),(0,r.jsx)(n.td,{children:"System endpoints (hostname, status, uptime, disk, memory, load)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/api/network/"})}),(0,r.jsx)(n.td,{children:"Network endpoints (DNS, ping)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/api/job/"})}),(0,r.jsx)(n.td,{children:"Job queue endpoints (create, get, list, delete, status, workers)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/api/health/"})}),(0,r.jsx)(n.td,{children:"Health check endpoints (liveness, readiness, status)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/api/common/"})}),(0,r.jsx)(n.td,{children:"Shared middleware, error handling, collection responses"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"(metrics)"}),(0,r.jsxs)(n.td,{children:["Prometheus endpoint (",(0,r.jsx)(n.code,{children:"/metrics"}),") via OpenTelemetry"]})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["All state-changing operations are dispatched as jobs through the job client\nlayer rather than executed inline. Responses follow a uniform collection\nenvelope documented in the ",(0,r.jsx)(n.a,{href:"/osapi/sidebar/api-guidelines",children:"API Design Guidelines"}),"."]}),"\n",(0,r.jsxs)(n.h3,{id:"job-system-internaljob",children:["Job System (",(0,r.jsx)(n.code,{children:"internal/job/"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["The job system implements a ",(0,r.jsx)(n.strong,{children:"KV-first, stream-notification architecture"})," on\nNATS JetStream. Core types live in ",(0,r.jsx)(n.code,{children:"internal/job/"}),", with two subpackages:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Package"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/job/client/"})}),(0,r.jsx)(n.td,{children:"High-level operations (create, status, query)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/job/worker/"})}),(0,r.jsx)(n.td,{children:"Consumer pipeline (subscribe, handle, process)"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Subject routing uses dot-notation hierarchies (",(0,r.jsx)(n.code,{children:"jobs.query.*"}),", ",(0,r.jsx)(n.code,{children:"jobs.modify.*"}),")\nwith support for load-balanced (",(0,r.jsx)(n.code,{children:"_any"}),"), broadcast (",(0,r.jsx)(n.code,{children:"_all"}),"), direct-host, and\nlabel-based targeting."]}),"\n",(0,r.jsxs)(n.p,{children:["For the full deep dive see ",(0,r.jsx)(n.a,{href:"/osapi/sidebar/architecture/job-architecture",children:"Job System Architecture"}),"."]}),"\n",(0,r.jsxs)(n.h3,{id:"provider-layer-internalprovider",children:["Provider Layer (",(0,r.jsx)(n.code,{children:"internal/provider/"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"Providers implement the actual system operations behind a common interface. Each\nprovider is selected at runtime through a platform-aware factory pattern."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Domain"}),(0,r.jsx)(n.th,{children:"Providers"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"system/host"})}),(0,r.jsx)(n.td,{children:"Hostname, uptime, OS info"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"system/disk"})}),(0,r.jsx)(n.td,{children:"Disk usage statistics"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"system/mem"})}),(0,r.jsx)(n.td,{children:"Memory usage statistics"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"system/load"})}),(0,r.jsx)(n.td,{children:"Load average statistics"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"network/dns"})}),(0,r.jsx)(n.td,{children:"DNS configuration (get/update)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"network/ping"})}),(0,r.jsx)(n.td,{children:"Ping execution and statistics"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Providers are stateless and platform-specific (e.g., a Ubuntu DNS provider vs. a\ngeneric Linux DNS provider). Adding a new operation means implementing the\nprovider interface and registering it in the worker's processor dispatch."}),"\n",(0,r.jsxs)(n.h3,{id:"configuration-internalconfig",children:["Configuration (",(0,r.jsx)(n.code,{children:"internal/config/"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Configuration is managed by ",(0,r.jsx)(n.a,{href:"https://github.com/spf13/viper",children:"Viper"})," and loaded from an ",(0,r.jsx)(n.code,{children:"osapi.yaml"})," file.\nEnvironment variables override file values using the ",(0,r.jsx)(n.code,{children:"OSAPI_"})," prefix with\nunderscore-separated keys (e.g., ",(0,r.jsx)(n.code,{children:"OSAPI_API_SERVER_PORT"}),")."]}),"\n",(0,r.jsxs)(n.p,{children:["Minimal configuration skeleton (see ",(0,r.jsx)(n.a,{href:"/osapi/sidebar/configuration",children:"Configuration"})," for the\nfull reference):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"api:\n  client:\n    url: 'http://localhost:8080'\n    security:\n      bearer_token: '<jwt>'\n  server:\n    port: 8080\n    nats:\n      host: 'localhost'\n      port: 4222\n      client_name: 'osapi-api'\n    security:\n      signing_key: '<secret>'\n      cors:\n        allow_origins: []\n\nnats:\n  server:\n    host: '0.0.0.0'\n    port: 4222\n    store_dir: '/tmp/nats-store'\n\njob:\n  stream_name: 'JOBS'\n  kv_bucket: 'job-queue'\n  kv_response_bucket: 'job-responses'\n  consumer_name: 'jobs-worker'\n  worker:\n    nats:\n      host: 'localhost'\n      port: 4222\n      client_name: 'osapi-job-worker'\n    hostname: 'worker-01'\n    labels:\n      group: 'web.dev'\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"health-checks-internalapihealth",children:["Health Checks (",(0,r.jsx)(n.code,{children:"internal/api/health/"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["The API server exposes three health check endpoints following the Kubernetes\nliveness/readiness probe pattern. These endpoints live outside the ",(0,r.jsx)(n.code,{children:"/api/v1/"}),"\nprefix at ",(0,r.jsx)(n.code,{children:"/health"})," because they serve infrastructure concerns rather than\nbusiness operations."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Endpoint"}),(0,r.jsx)(n.th,{children:"Auth"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GET /health"})}),(0,r.jsx)(n.td,{children:"None"}),(0,r.jsx)(n.td,{children:"Liveness \u2014 returns 200 if the process runs"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GET /health/ready"})}),(0,r.jsx)(n.td,{children:"None"}),(0,r.jsx)(n.td,{children:"Readiness \u2014 verifies dependencies"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GET /health/status"})}),(0,r.jsxs)(n.td,{children:["JWT ",(0,r.jsx)(n.code,{children:"read"})]}),(0,r.jsx)(n.td,{children:"System status with metrics for operators"})]})]})]}),"\n",(0,r.jsxs)(n.h3,{id:"liveness-health",children:["Liveness (",(0,r.jsx)(n.code,{children:"/health"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Returns ",(0,r.jsx)(n.code,{children:'{"status":"ok"}'})," unconditionally. No dependency checks are performed.\nIf the HTTP server responds, the process is alive. This endpoint is deliberately\ntrivial \u2014 putting dependency checks here would cause orchestrators to restart\nthe process during a transient NATS outage, creating a restart storm on top of\nthe original problem."]}),"\n",(0,r.jsxs)(n.h3,{id:"readiness-healthready",children:["Readiness (",(0,r.jsx)(n.code,{children:"/health/ready"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Runs all checks registered with the ",(0,r.jsx)(n.code,{children:"Checker"})," interface and returns 200\n(",(0,r.jsx)(n.code,{children:"ready"}),") or 503 (",(0,r.jsx)(n.code,{children:"not_ready"}),"). The default checker (",(0,r.jsx)(n.code,{children:"NATSChecker"}),") verifies:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"NATS connectivity"})," \u2014 the NATS connection is active and has a connected URL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"KV bucket access"})," \u2014 the ",(0,r.jsx)(n.code,{children:"job-queue"})," KV bucket is reachable and can list\nkeys"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Load balancers should use this endpoint to decide whether to route traffic. When\nreadiness fails, the server stays running but stops receiving requests until the\ndependency recovers."}),"\n",(0,r.jsxs)(n.h3,{id:"status-healthstatus",children:["Status (",(0,r.jsx)(n.code,{children:"/health/status"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Breaks out each dependency as a named component with its own status and error\nmessage. Also reports NATS connection info, JetStream stream statistics, KV\nbucket statistics, job queue counts, application version, and uptime. Returns\n",(0,r.jsx)(n.code,{children:"ok"})," when all components are healthy or ",(0,r.jsx)(n.code,{children:"degraded"})," (with HTTP 503) when any\ncomponent fails. Requires JWT authentication because it exposes internal\ntopology."]}),"\n",(0,r.jsx)(n.p,{children:"Components checked:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Component"}),(0,r.jsx)(n.th,{children:"What it checks"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nats"})}),(0,r.jsx)(n.td,{children:"NATS client is connected"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"kv"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"job-queue"})," KV bucket is accessible"]})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Additional metrics (optional, gracefully skipped on failure):"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Section"}),(0,r.jsx)(n.th,{children:"What it reports"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nats"})}),(0,r.jsx)(n.td,{children:"Connected URL, server version"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"streams"})}),(0,r.jsx)(n.td,{children:"Message count, bytes, consumer count"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"kv"})}),(0,r.jsx)(n.td,{children:"Bucket name, key count, bytes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"jobs"})}),(0,r.jsx)(n.td,{children:"Total, unprocessed, processing, completed, failed, DLQ"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"cli-access",children:"CLI Access"}),"\n",(0,r.jsx)(n.p,{children:"Operators can check health from the command line:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"osapi client health              # liveness\nosapi client health ready        # readiness\nosapi client health status       # system status with metrics (requires auth)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"request-flow",children:"Request Flow"}),"\n",(0,r.jsxs)(n.p,{children:["A typical operation (e.g., ",(0,r.jsx)(n.code,{children:"system.hostname.get"}),") follows these steps:"]}),"\n",(0,r.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant CLI\n    participant API as REST API\n    participant JC as Job Client\n    participant NATS as NATS JetStream\n    participant Worker\n    participant Provider\n\n    CLI->>API: POST /api/v1/jobs\n    API->>JC: CreateJob()\n    JC->>NATS: store job in KV (job-queue)\n    JC->>NATS: publish notification to JOBS stream\n    API--\x3e>CLI: 201 (job_id)\n    NATS->>Worker: deliver stream notification\n    Worker->>NATS: fetch immutable job from KV\n    Worker->>Provider: execute operation\n    Provider--\x3e>Worker: result\n    Worker->>NATS: write status events + result to KV\n    CLI->>API: GET /api/v1/jobs/{id}\n    API->>NATS: read computed status from KV\n    API--\x3e>CLI: 200 (result)"}),"\n",(0,r.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,r.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,r.jsxs)(n.p,{children:["The API uses ",(0,r.jsx)(n.strong,{children:"JWT HS256"})," tokens signed with a shared secret\n(",(0,r.jsx)(n.code,{children:"security.signing_key"}),"). Tokens carry a ",(0,r.jsx)(n.code,{children:"role"})," claim that determines the\ncaller's access level. The ",(0,r.jsx)(n.code,{children:"osapi token generate"})," command creates tokens for a\ngiven role."]}),"\n",(0,r.jsx)(n.h3,{id:"authorization",children:"Authorization"}),"\n",(0,r.jsx)(n.p,{children:"Access control is scope-based with a three-tier role hierarchy:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Role"}),(0,r.jsx)(n.th,{children:"Scopes"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"admin"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"read"}),", ",(0,r.jsx)(n.code,{children:"write"}),", ",(0,r.jsx)(n.code,{children:"admin"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"write"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"read"}),", ",(0,r.jsx)(n.code,{children:"write"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"read"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"read"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Each API endpoint declares a required scope. The JWT middleware checks that the\ncaller's role includes that scope before allowing the request. The health\nendpoints ",(0,r.jsx)(n.code,{children:"/health"})," and ",(0,r.jsx)(n.code,{children:"/health/ready"})," are exceptions \u2014 they bypass JWT\nauthentication so that load balancers and orchestrators can probe them without\ncredentials."]}),"\n",(0,r.jsx)(n.h3,{id:"cors",children:"CORS"}),"\n",(0,r.jsxs)(n.p,{children:["Cross-Origin Resource Sharing is configured per-server via\n",(0,r.jsx)(n.code,{children:"api.server.security.cors.allow_origins"})," in ",(0,r.jsx)(n.code,{children:"osapi.yaml"}),". An empty list disables\nCORS headers entirely."]}),"\n",(0,r.jsx)(n.h2,{id:"external-dependencies",children:"External Dependencies"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Dependency"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://echo.labstack.com",children:"Echo"})}),(0,r.jsx)(n.td,{children:"HTTP framework for the REST API"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.a,{href:"https://github.com/spf13/cobra",children:"Cobra"})," / ",(0,r.jsx)(n.a,{href:"https://github.com/spf13/viper",children:"Viper"})]}),(0,r.jsx)(n.td,{children:"CLI framework and configuration"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.a,{href:"https://nats.io",children:"NATS"})," / JetStream"]}),(0,r.jsx)(n.td,{children:"Messaging, KV store, stream processing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/oapi-codegen/oapi-codegen",children:"oapi-codegen"})}),(0,r.jsx)(n.td,{children:"OpenAPI strict-server code generation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://opentelemetry.io",children:"OpenTelemetry"})}),(0,r.jsx)(n.td,{children:"Distributed tracing and Prometheus metrics"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/shirou/gopsutil",children:"gopsutil"})}),(0,r.jsx)(n.td,{children:"Cross-platform system metrics"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/prometheus-community/pro-bing",children:"pro-bing"})}),(0,r.jsx)(n.td,{children:"ICMP ping implementation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/golang-jwt/jwt",children:"golang-jwt"})}),(0,r.jsx)(n.td,{children:"JWT creation and validation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"nats-client"})," / ",(0,r.jsx)(n.code,{children:"nats-server"})]}),(0,r.jsxs)(n.td,{children:["Sibling repos (linked via ",(0,r.jsx)(n.code,{children:"go.mod"})," replace)"]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/osapi/sidebar/architecture/job-architecture",children:"Job System Architecture"})," \u2014 deep dive into the KV-first\njob system, subject routing, and worker pipeline"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/osapi/sidebar/api-guidelines",children:"API Design Guidelines"})," \u2014 REST conventions, collection\nenvelopes, and endpoint patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/osapi/sidebar/principles",children:"Guiding Principles"})," \u2014 design philosophy and project values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/osapi/sidebar/development",children:"Development"})," \u2014 setup, building, testing, and contributing"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453(e,n,s){s.d(n,{R:()=>d,x:()=>c});var r=s(96540);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);