"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3583],{15084(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});var i=t(74848),r=t(28453);const o={title:"Add job retry command",status:"done",created:new Date("2026-02-19T00:00:00.000Z"),updated:new Date("2026-02-19T00:00:00.000Z")},d=void 0,s={id:"sidebar/development/tasks/done/2026-02-19-feat-job-retry-command",title:"Add job retry command",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-19-feat-job-retry-command.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-19-feat-job-retry-command",permalink:"/osapi/sidebar/development/tasks/done/2026-02-19-feat-job-retry-command",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Add job retry command",status:"done",created:"2026-02-19T00:00:00.000Z",updated:"2026-02-19T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Rename health detailed to health status and enrich with system metrics",permalink:"/osapi/sidebar/development/tasks/done/2026-02-19-feat-health-status"},next:{title:"Add server-side pagination to job list",permalink:"/osapi/sidebar/development/tasks/done/2026-02-19-fix-job-list-pagination"}},l={},a=[{value:"Objective",id:"objective",level:2},{value:"Approach",id:"approach",level:2},{value:"Scope",id:"scope",level:2},{value:"Job Client",id:"job-client",level:3},{value:"API",id:"api",level:3},{value:"Client Wrapper",id:"client-wrapper",level:3},{value:"CLI",id:"cli",level:3},{value:"Tests",id:"tests",level:3},{value:"Notes",id:"notes",level:2},{value:"Outcome",id:"outcome",level:2}];function c(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,i.jsxs)(n.p,{children:["Add a ",(0,i.jsx)(n.code,{children:"job retry --job-id <id>"})," command that re-submits a stuck or failed job by\nreading its stored operation data from KV and publishing a new notification to\nthe stream. This avoids requiring users to manually reconstruct and re-run the\noriginal CLI command."]}),"\n",(0,i.jsx)(n.h2,{id:"approach",children:"Approach"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Read the original job's operation data and target from KV (",(0,i.jsx)(n.code,{children:"jobs.<id>"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Create a new job with the same operation and target using the existing\n",(0,i.jsx)(n.code,{children:"CreateJob"})," flow"]}),"\n",(0,i.jsx)(n.li,{children:"Return the new job ID so the user can track it"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The original job remains unchanged (preserves history). The retry creates a\nbrand new job with a new ID."}),"\n",(0,i.jsx)(n.h2,{id:"scope",children:"Scope"}),"\n",(0,i.jsx)(n.h3,{id:"job-client",children:"Job Client"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"internal/job/client/types.go"})," \u2014 Add ",(0,i.jsx)(n.code,{children:"RetryJob"})," to ",(0,i.jsx)(n.code,{children:"JobClient"})," interface"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"internal/job/client/jobs.go"})," \u2014 Implement ",(0,i.jsx)(n.code,{children:"RetryJob(ctx, jobID)"})," that reads\nthe original job, extracts operation + target, calls ",(0,i.jsx)(n.code,{children:"CreateJob"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"api",children:"API"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"internal/api/job/gen/api.yaml"})," \u2014 Add ",(0,i.jsx)(n.code,{children:"POST /job/{id}/retry"})," endpoint"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"internal/api/job/job_retry.go"})," \u2014 Handler that calls ",(0,i.jsx)(n.code,{children:"RetryJob"})," and returns\nthe new job ID"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"client-wrapper",children:"Client Wrapper"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"internal/client/job_retry.go"})," \u2014 ",(0,i.jsx)(n.code,{children:"PostJobRetry(ctx, id)"})," wrapper"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"internal/client/handler.go"})," \u2014 Add to ",(0,i.jsx)(n.code,{children:"JobHandler"})," interface"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"cli",children:"CLI"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cmd/client_job_retry.go"})," \u2014 ",(0,i.jsx)(n.code,{children:"job retry --job-id <id>"})," command that calls the\nAPI and displays the new job ID"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tests",children:"Tests"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Unit tests for ",(0,i.jsx)(n.code,{children:"RetryJob"}),", API handler, client wrapper"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Should work for any terminal status: ",(0,i.jsx)(n.code,{children:"submitted"})," (stuck), ",(0,i.jsx)(n.code,{children:"failed"}),",\n",(0,i.jsx)(n.code,{children:"partial_failure"})]}),"\n",(0,i.jsxs)(n.li,{children:["Consider whether to allow retrying ",(0,i.jsx)(n.code,{children:"completed"})," jobs (probably yes, for\nre-running queries)"]}),"\n",(0,i.jsx)(n.li,{children:"The new job gets its own timeline and status events \u2014 no link back to the\noriginal job (keep it simple for now)"}),"\n",(0,i.jsxs)(n.li,{children:["Future enhancement: add ",(0,i.jsx)(n.code,{children:"retried_from"})," field to link job lineage"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"outcome",children:"Outcome"}),"\n",(0,i.jsx)(n.p,{children:"Implemented job retry command with full validation and test coverage:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RetryJob"}),' in job client reads original job from KV, creates new job, writes\n"retried" status event on original job linking to new job']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /job/{id}/retry"})," API endpoint with optional ",(0,i.jsx)(n.code,{children:"target_hostname"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"osapi client job retry --job-id <id>"})," CLI command"]}),"\n",(0,i.jsxs)(n.li,{children:["UUID validation via ",(0,i.jsx)(n.code,{children:"format: uuid"})," in OpenAPI spec (framework-level)"]}),"\n",(0,i.jsx)(n.li,{children:"Enum validation for job list status filter"}),"\n",(0,i.jsx)(n.li,{children:"Integration tests for all job endpoints with user input"}),"\n",(0,i.jsx)(n.li,{children:"Updated CLAUDE.md with validation pattern documentation"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453(e,n,t){t.d(n,{R:()=>d,x:()=>s});var i=t(96540);const r={},o=i.createContext(r);function d(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);