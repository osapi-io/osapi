"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2846],{38803(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var r=t(74848),s=t(28453);const i={title:"Port network API to strict-server + job client",status:"done",created:new Date("2026-02-15T00:00:00.000Z"),updated:new Date("2026-02-15T00:00:00.000Z")},o=void 0,d={id:"sidebar/development/tasks/done/2026-02-15-refactor-network-api-strict-server",title:"Port network API to strict-server + job client",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-15-refactor-network-api-strict-server.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-15-refactor-network-api-strict-server",permalink:"/osapi/sidebar/development/tasks/done/2026-02-15-refactor-network-api-strict-server",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Port network API to strict-server + job client",status:"done",created:"2026-02-15T00:00:00.000Z",updated:"2026-02-15T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Audit and ensure validation on all API endpoints",permalink:"/osapi/sidebar/development/tasks/done/2026-02-15-fix-api-endpoint-validation-audit"},next:{title:"Fix operation naming inconsistencies",permalink:"/osapi/sidebar/development/tasks/done/2026-02-15-refactor-operation-naming"}},c={},l=[{value:"Objective",id:"objective",level:2},{value:"Changes",id:"changes",level:2},{value:"Tests",id:"tests",level:2},{value:"Outcome",id:"outcome",level:2}];function a(e){const n={code:"code",h2:"h2",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,r.jsx)(n.p,{children:"Rewrite network API from non-strict + direct providers + legacy tasks to\nstrict-server + job client. Biggest handler rewrite."}),"\n",(0,r.jsx)(n.h2,{id:"changes",children:"Changes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Enabled strict-server in ",(0,r.jsx)(n.code,{children:"network/gen/cfg.yaml"})]}),"\n",(0,r.jsx)(n.li,{children:"Added BearerAuth security to all network OpenAPI endpoints"}),"\n",(0,r.jsxs)(n.li,{children:["Preserved ",(0,r.jsx)(n.code,{children:"x-oapi-codegen-extra-tags"})," validation tags on all schemas"]}),"\n",(0,r.jsx)(n.li,{children:"Preserved 400 response types for validation errors"}),"\n",(0,r.jsxs)(n.li,{children:["Rewrote ",(0,r.jsx)(n.code,{children:"types.go"}),": replaced PingProvider, DNSProvider, TaskClientManager with\nsingle ",(0,r.jsx)(n.code,{children:"JobClient"})]}),"\n",(0,r.jsxs)(n.li,{children:["Rewrote ",(0,r.jsx)(n.code,{children:"network.go"}),": StrictServerInterface compile-time check"]}),"\n",(0,r.jsxs)(n.li,{children:["Rewrote ",(0,r.jsx)(n.code,{children:"network_dns_get_by_interface.go"}),": uses ",(0,r.jsx)(n.code,{children:"JobClient.QueryNetworkDNS"})]}),"\n",(0,r.jsxs)(n.li,{children:["Rewrote ",(0,r.jsx)(n.code,{children:"network_dns_put_by_interface.go"}),": uses\n",(0,r.jsx)(n.code,{children:"JobClient.ModifyNetworkDNSAny"}),", keeps validator for request body"]}),"\n",(0,r.jsxs)(n.li,{children:["Rewrote ",(0,r.jsx)(n.code,{children:"network_ping_post.go"}),": uses ",(0,r.jsx)(n.code,{children:"JobClient.QueryNetworkPingAny"}),", keeps\nvalidator for request body, keeps ",(0,r.jsx)(n.code,{children:"durationToString"})," helper"]}),"\n",(0,r.jsxs)(n.li,{children:["Rewrote ",(0,r.jsx)(n.code,{children:"handler_network.go"}),": same pattern as system/job handlers with\n",(0,r.jsx)(n.code,{children:"NewStrictHandler"})," + ",(0,r.jsx)(n.code,{children:"scopeMiddleware"})]}),"\n",(0,r.jsxs)(n.li,{children:["Simplified ",(0,r.jsx)(n.code,{children:"handler.go"}),": removed ",(0,r.jsx)(n.code,{children:"appFs afero.Fs"})," parameter"]}),"\n",(0,r.jsxs)(n.li,{children:["Simplified ",(0,r.jsx)(n.code,{children:"manager.go"}),": interface matches new signature"]}),"\n",(0,r.jsxs)(n.li,{children:["Updated ",(0,r.jsx)(n.code,{children:"cmd/api_server_start.go"}),": removed ",(0,r.jsx)(n.code,{children:"appFs"})," from CreateHandlers call"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"tests",children:"Tests"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Deleted old integration tests (3 files)"}),"\n",(0,r.jsxs)(n.li,{children:["Created 3 new public test files with MockJobClient:\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"network_dns_get_by_interface_public_test.go"})," (success, error)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"network_dns_put_by_interface_public_test.go"})," (success, validation error,\nerror)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"network_ping_post_public_test.go"})," (success, validation error, error)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Kept ",(0,r.jsx)(n.code,{children:"network_test.go"})," (internal ",(0,r.jsx)(n.code,{children:"durationToString"})," tests)"]}),"\n",(0,r.jsx)(n.li,{children:"All 11 tests pass"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"outcome",children:"Outcome"}),"\n",(0,r.jsx)(n.p,{children:"All network API handlers now use job client via NATS. All three API domains\n(system, network, job) consistently use strict-server with BearerAuth JWT\nmiddleware."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453(e,n,t){t.d(n,{R:()=>o,x:()=>d});var r=t(96540);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);