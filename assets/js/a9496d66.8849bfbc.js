"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4434],{53725(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var s=i(74848),r=i(28453);const t={title:"Document worker hardening and least-privilege deployment",status:"backlog",created:new Date("2026-02-22T00:00:00.000Z"),updated:new Date("2026-02-22T00:00:00.000Z")},l=void 0,o={id:"sidebar/development/tasks/backlog/2026-02-22-docs-worker-hardening",title:"Document worker hardening and least-privilege deployment",description:"Objective",source:"@site/docs/sidebar/development/tasks/backlog/2026-02-22-docs-worker-hardening.md",sourceDirName:"sidebar/development/tasks/backlog",slug:"/sidebar/development/tasks/backlog/2026-02-22-docs-worker-hardening",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-22-docs-worker-hardening",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Document worker hardening and least-privilege deployment",status:"backlog",created:"2026-02-22T00:00:00.000Z",updated:"2026-02-22T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Evaluate query param validation strategy",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-21-discuss-query-param-validation"},next:{title:"Client SDK for programmatic automation",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-22-feat-client-sdk"}},a={},d=[{value:"Objective",id:"objective",level:2},{value:"Content",id:"content",level:2},{value:"Least-Privilege Capabilities",id:"least-privilege-capabilities",level:3},{value:"systemd Unit Hardening",id:"systemd-unit-hardening",level:3},{value:"AppArmor Profile",id:"apparmor-profile",level:3},{value:"Placement",id:"placement",level:3},{value:"Notes",id:"notes",level:2}];function c(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,s.jsx)(n.p,{children:"Write a deployment guide for running the OSAPI worker with minimal privileges\nusing systemd sandboxing and AppArmor. The guide should cover capability\nmanagement, filesystem restrictions, command whitelisting, and resource limits."}),"\n",(0,s.jsxs)(n.p,{children:["This is documentation, not code. The worker already enforces ",(0,s.jsx)(n.code,{children:"command:execute"}),"\npermissions via RBAC. OS-level hardening is a deployment concern that layers\ndefense in depth on top."]}),"\n",(0,s.jsx)(n.h2,{id:"content",children:"Content"}),"\n",(0,s.jsx)(n.h3,{id:"least-privilege-capabilities",children:"Least-Privilege Capabilities"}),"\n",(0,s.jsxs)(n.p,{children:["The worker needs specific Linux capabilities for certain operations. Document\nhow to grant only what's needed via systemd instead of running as root or using\n",(0,s.jsx)(n.code,{children:"setcap"})," on the binary:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Ping"})," requires ",(0,s.jsx)(n.code,{children:"CAP_NET_RAW"}),". Two approaches:\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AmbientCapabilities=CAP_NET_RAW"})," in the systemd unit (preferred, survives\nbinary updates)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sudo setcap cap_net_raw=+ep ./osapi"})," on the binary (must be reapplied after\nevery build/deploy)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'sudo sysctl -w net.ipv4.ping_group_range="0 2147483647"'})," as a system-wide\nalternative (allows all users to ping)"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Document which capabilities each OSAPI operation requires"}),"\n",(0,s.jsx)(n.li,{children:"Show how to run the worker as a dedicated non-root user with only the\ncapabilities it needs"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"systemd-unit-hardening",children:"systemd Unit Hardening"}),"\n",(0,s.jsx)(n.p,{children:"Document recommended systemd directives for the worker service:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"User=osapi"})," / ",(0,s.jsx)(n.code,{children:"Group=osapi"})," \u2014 dedicated service account"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AmbientCapabilities=CAP_NET_RAW"})," \u2014 grant only needed capabilities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CapabilityBoundingSet=CAP_NET_RAW"})," \u2014 drop everything else"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"NoNewPrivileges=yes"})," \u2014 child processes (executed commands) cannot gain\nadditional privileges"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ProtectSystem=strict"})," \u2014 read-only filesystem except allowed paths"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ReadWritePaths="})," \u2014 whitelist paths the worker needs to write (e.g., NATS\nstore dir, temp dirs)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ProtectHome=yes"})," \u2014 no access to /home"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"InaccessiblePaths="})," \u2014 block sensitive paths entirely"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PrivateTmp=yes"})," \u2014 isolated /tmp for the worker and its children"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SystemCallFilter="})," \u2014 restrict available syscalls"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"MemoryMax="})," / ",(0,s.jsx)(n.code,{children:"CPUQuota="})," \u2014 resource limits for the worker and executed\ncommands"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ExecPaths="})," / ",(0,s.jsx)(n.code,{children:"NoExecPaths="})," \u2014 whitelist which binaries the worker can\nexecute (systemd 254+, command whitelisting at the OS level)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Provide a complete example unit file with sensible defaults and comments\nexplaining each directive."}),"\n",(0,s.jsx)(n.h3,{id:"apparmor-profile",children:"AppArmor Profile"}),"\n",(0,s.jsx)(n.p,{children:"Document an AppArmor profile for the worker that restricts:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Which binaries the worker can ",(0,s.jsx)(n.code,{children:"exec()"})," (command whitelisting)"]}),"\n",(0,s.jsx)(n.li,{children:"Which paths the worker can read/write"}),"\n",(0,s.jsx)(n.li,{children:"Network access scope"}),"\n",(0,s.jsx)(n.li,{children:"Capability restrictions"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Provide a sample profile and instructions for loading/enforcing it."}),"\n",(0,s.jsx)(n.h3,{id:"placement",children:"Placement"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"docs/docs/sidebar/deployment/worker-hardening.md"})," or similar"]}),"\n",(0,s.jsx)(n.li,{children:"Link from the command execution feature page"}),"\n",(0,s.jsx)(n.li,{children:"Link from the configuration reference"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Target audience is operators deploying OSAPI in production"}),"\n",(0,s.jsx)(n.li,{children:"Should cover Debian/Ubuntu (AppArmor) as primary; mention SELinux for RHEL as\nan alternative"}),"\n",(0,s.jsx)(n.li,{children:"Keep examples copy-pasteable with comments explaining each directive"}),"\n",(0,s.jsx)(n.li,{children:"Document the capability requirements for each OSAPI provider so operators know\nexactly what to grant"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453(e,n,i){i.d(n,{R:()=>l,x:()=>o});var s=i(96540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);