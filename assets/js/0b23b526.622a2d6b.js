"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2331],{52574(e,n,d){d.r(n),d.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>r});var s=d(74848),i=d(28453);const t={date:new Date("2026-02-27T00:00:00.000Z")},l=void 0,c={id:"sidebar/development/tasks/sessions/2026-02-27",title:"2026-02-27",description:"Summary",source:"@site/docs/sidebar/development/tasks/sessions/2026-02-27.md",sourceDirName:"sidebar/development/tasks/sessions",slug:"/sidebar/development/tasks/sessions/2026-02-27",permalink:"/osapi/sidebar/development/tasks/sessions/2026-02-27",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{date:"2026-02-27T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"2026-02-20",permalink:"/osapi/sidebar/development/tasks/sessions/2026-02-20"},next:{title:"Roadmap",permalink:"/osapi/sidebar/development/roadmap"}},a={},r=[{value:"Summary",id:"summary",level:2},{value:"Changes",id:"changes",level:2},{value:"Phase 1: Agent/Node Split",id:"phase-1-agentnode-split",level:3},{value:"Phase 2: Health Status Enhancements",id:"phase-2-health-status-enhancements",level:3},{value:"Phase 3: Documentation",id:"phase-3-documentation",level:3},{value:"Decisions",id:"decisions",level:2},{value:"Agent CLI + Config Rename",id:"agent-cli--config-rename",level:3},{value:"Decisions",id:"decisions-1",level:2},{value:"Health Status Detail Enhancements",id:"health-status-detail-enhancements",level:3},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"Implemented Phase 1 (agent/node taxonomy split), Phase 2 (health status\nenhancements), and Phase 3 (documentation) of the agent-node taxonomy\nreorganization plan."}),"\n",(0,s.jsx)(n.h2,{id:"changes",children:"Changes"}),"\n",(0,s.jsx)(n.h3,{id:"phase-1-agentnode-split",children:"Phase 1: Agent/Node Split"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Created ",(0,s.jsx)(n.code,{children:"internal/api/agent/"})," package with full OpenAPI spec, handlers, and\ntests for ",(0,s.jsx)(n.code,{children:"GET /agent"})," (list) and ",(0,s.jsx)(n.code,{children:"GET /agent/{hostname}"})," (get detail)"]}),"\n",(0,s.jsxs)(n.li,{children:["Trimmed ",(0,s.jsx)(n.code,{children:"internal/api/node/"})," to keep only ",(0,s.jsx)(n.code,{children:"GET /node/hostname"})," and\n",(0,s.jsx)(n.code,{children:"GET /node/status"})]}),"\n",(0,s.jsxs)(n.li,{children:["Added ",(0,s.jsx)(n.code,{children:"agent:read"})," permission to ",(0,s.jsx)(n.code,{children:"internal/authtoken/permissions.go"})," and all\nthree default roles"]}),"\n",(0,s.jsxs)(n.li,{children:["Created ",(0,s.jsx)(n.code,{children:"internal/api/handler_agent.go"})," for server wiring with\n",(0,s.jsx)(n.code,{children:"scopeMiddleware"})]}),"\n",(0,s.jsxs)(n.li,{children:["Created CLI commands: ",(0,s.jsx)(n.code,{children:"cmd/client_agent.go"}),", ",(0,s.jsx)(n.code,{children:"cmd/client_agent_list.go"}),",\n",(0,s.jsx)(n.code,{children:"cmd/client_agent_get.go"})]}),"\n",(0,s.jsxs)(n.li,{children:["Deleted ",(0,s.jsx)(n.code,{children:"cmd/client_node_list.go"}),", ",(0,s.jsx)(n.code,{children:"cmd/client_node_get.go"})]}),"\n",(0,s.jsxs)(n.li,{children:["Updated SDK: new ",(0,s.jsx)(n.code,{children:"AgentService"})," in ",(0,s.jsx)(n.code,{children:"osapi-sdk/pkg/osapi/agent.go"}),", trimmed\n",(0,s.jsx)(n.code,{children:"NodeService"}),", regenerated merged spec and client code"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"phase-2-health-status-enhancements",children:"Phase 2: Health Status Enhancements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Updated ",(0,s.jsx)(n.code,{children:"newMetricsProvider"})," to accept ",(0,s.jsx)(n.code,{children:"registryKV"})," and ",(0,s.jsx)(n.code,{children:"auditKV"})," params,\nquerying all KV buckets (not just jobsKV)"]}),"\n",(0,s.jsxs)(n.li,{children:["Added ",(0,s.jsx)(n.code,{children:"ConsumerMetrics"})," type and ",(0,s.jsx)(n.code,{children:"GetConsumerStats"})," to ",(0,s.jsx)(n.code,{children:"MetricsProvider"}),"\ninterface"]}),"\n",(0,s.jsxs)(n.li,{children:["Added ",(0,s.jsx)(n.code,{children:"ConsumerStats"})," schema to health OpenAPI spec and ",(0,s.jsx)(n.code,{children:"consumers"})," field to\n",(0,s.jsx)(n.code,{children:"StatusResponse"})]}),"\n",(0,s.jsx)(n.li,{children:"Updated health handler to populate consumer stats"}),"\n",(0,s.jsx)(n.li,{children:"Updated CLI health status display with consumer count"}),"\n",(0,s.jsx)(n.li,{children:"Updated SDK health spec and regenerated"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"phase-3-documentation",children:"Phase 3: Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Created ",(0,s.jsx)(n.code,{children:"docs/docs/sidebar/usage/cli/client/agent/"})," with ",(0,s.jsx)(n.code,{children:"agent.mdx"}),",\n",(0,s.jsx)(n.code,{children:"list.md"}),", ",(0,s.jsx)(n.code,{children:"get.md"})]}),"\n",(0,s.jsxs)(n.li,{children:["Updated ",(0,s.jsx)(n.code,{children:"node/node.mdx"})," to reference only job-based commands"]}),"\n",(0,s.jsxs)(n.li,{children:["Removed ",(0,s.jsx)(n.code,{children:"node/list.md"})," and ",(0,s.jsx)(n.code,{children:"node/get.md"})," (moved to agent/)"]}),"\n",(0,s.jsxs)(n.li,{children:["Updated ",(0,s.jsx)(n.code,{children:"features/node-management.md"})," to clarify agent vs node distinction"]}),"\n",(0,s.jsxs)(n.li,{children:["Updated ",(0,s.jsx)(n.code,{children:"configuration.md"})," with ",(0,s.jsx)(n.code,{children:"agent:read"})," permission in roles table"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"decisions",children:"Decisions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Agent endpoints use ",(0,s.jsx)(n.code,{children:"agent:read"})," permission; node endpoints keep ",(0,s.jsx)(n.code,{children:"node:read"})]}),"\n",(0,s.jsxs)(n.li,{children:["All three default roles (admin, write, read) include ",(0,s.jsx)(n.code,{children:"agent:read"})]}),"\n",(0,s.jsxs)(n.li,{children:["SDK linked via ",(0,s.jsx)(n.code,{children:"replace"})," directive in go.mod during development"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"agent-cli--config-rename",children:"Agent CLI + Config Rename"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Renamed CLI: ",(0,s.jsx)(n.code,{children:"osapi node agent start"})," \u2192 ",(0,s.jsx)(n.code,{children:"osapi agent start"})]}),"\n",(0,s.jsxs)(n.li,{children:["Renamed config: ",(0,s.jsx)(n.code,{children:"node.agent.*"})," \u2192 ",(0,s.jsx)(n.code,{children:"agent.*"})]}),"\n",(0,s.jsxs)(n.li,{children:["Renamed types: ",(0,s.jsx)(n.code,{children:"NodeAgent"})," \u2192 ",(0,s.jsx)(n.code,{children:"AgentConfig"}),", ",(0,s.jsx)(n.code,{children:"NodeAgentConsumer"})," \u2192\n",(0,s.jsx)(n.code,{children:"AgentConsumer"}),", removed ",(0,s.jsx)(n.code,{children:"Node"})," wrapper struct"]}),"\n",(0,s.jsx)(n.li,{children:"Updated all 4 YAML config files, all agent test files, CLI docs, and\narchitecture docs"}),"\n",(0,s.jsxs)(n.li,{children:["Moved CLI docs from ",(0,s.jsx)(n.code,{children:"cli/node/agent/"})," to ",(0,s.jsx)(n.code,{children:"cli/agent/"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"decisions-1",children:"Decisions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Agent endpoints use ",(0,s.jsx)(n.code,{children:"agent:read"})," permission; node endpoints keep ",(0,s.jsx)(n.code,{children:"node:read"})]}),"\n",(0,s.jsxs)(n.li,{children:["All three default roles (admin, write, read) include ",(0,s.jsx)(n.code,{children:"agent:read"})]}),"\n",(0,s.jsxs)(n.li,{children:["SDK linked via ",(0,s.jsx)(n.code,{children:"replace"})," directive in go.mod during development"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"agent"})," is now a top-level CLI command (sibling of ",(0,s.jsx)(n.code,{children:"api"}),", ",(0,s.jsx)(n.code,{children:"nats"}),", ",(0,s.jsx)(n.code,{children:"client"}),")\nrather than nested under ",(0,s.jsx)(n.code,{children:"node"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"health-status-detail-enhancements",children:"Health Status Detail Enhancements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Added ",(0,s.jsx)(n.code,{children:"AgentDetail"})," and ",(0,s.jsx)(n.code,{children:"ConsumerDetail"})," schemas to health OpenAPI spec"]}),"\n",(0,s.jsx)(n.li,{children:"Added per-agent table to health status (hostname, labels, registered age)"}),"\n",(0,s.jsx)(n.li,{children:"Added per-consumer table to health status (name, pending, ack_pending,\nredelivered)"}),"\n",(0,s.jsxs)(n.li,{children:["Updated ",(0,s.jsx)(n.code,{children:"ConsumerStatsFn"})," to use ",(0,s.jsx)(n.code,{children:"stream.ListConsumers()"})," for per-consumer\ninfo instead of just ",(0,s.jsx)(n.code,{children:"info.State.Consumers"})," count"]}),"\n",(0,s.jsxs)(n.li,{children:["Updated ",(0,s.jsx)(n.code,{children:"AgentStatsFn"})," to return per-agent details from registry"]}),"\n",(0,s.jsxs)(n.li,{children:["Updated CLI ",(0,s.jsx)(n.code,{children:"displayStatusHealth"})," to render agent and consumer tables"]}),"\n",(0,s.jsxs)(n.li,{children:["Updated health types with ",(0,s.jsx)(n.code,{children:"AgentDetail"}),", ",(0,s.jsx)(n.code,{children:"ConsumerDetail"})," structs"]}),"\n",(0,s.jsx)(n.li,{children:"Updated all health tests (public + integration) with detailed data assertions"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Commit and push changes for review"}),"\n",(0,s.jsxs)(n.li,{children:["After SDK merge, remove ",(0,s.jsx)(n.code,{children:"replace"})," directive from go.mod"]}),"\n",(0,s.jsxs)(n.li,{children:["Move task file to ",(0,s.jsx)(n.code,{children:"done/"})," when merged"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453(e,n,d){d.d(n,{R:()=>l,x:()=>c});var s=d(96540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);