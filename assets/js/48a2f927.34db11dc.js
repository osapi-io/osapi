"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5148],{63020(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>i});var r=s(74848),t=s(28453);const d={title:"Add MCP server for AI agent integration",status:"backlog",created:new Date("2026-02-18T00:00:00.000Z"),updated:new Date("2026-02-18T00:00:00.000Z")},c=void 0,o={id:"sidebar/development/tasks/backlog/2026-02-18-feat-mcp-server",title:"Add MCP server for AI agent integration",description:"Objective",source:"@site/docs/sidebar/development/tasks/backlog/2026-02-18-feat-mcp-server.md",sourceDirName:"sidebar/development/tasks/backlog",slug:"/sidebar/development/tasks/backlog/2026-02-18-feat-mcp-server",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-18-feat-mcp-server",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Add MCP server for AI agent integration",status:"backlog",created:"2026-02-18T00:00:00.000Z",updated:"2026-02-18T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Evaluate WebSocket vs polling for job status updates",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-15-feat-websocket-vs-polling"},next:{title:"Add custom OTel metrics for jobs, agents, and NATS",permalink:"/osapi/sidebar/development/tasks/backlog/2026-02-20-feat-metrics-endpoint"}},l={},i=[{value:"Objective",id:"objective",level:2},{value:"Design",id:"design",level:2},{value:"Tools (5 total)",id:"tools-5-total",level:3},{value:"Package structure",id:"package-structure",level:3},{value:"Config",id:"config",level:3},{value:"Files to create/modify",id:"files-to-createmodify",level:2},{value:"Notes",id:"notes",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,r.jsx)(n.p,{children:"Add an MCP (Model Context Protocol) server that exposes OSAPI's system and\nnetwork operations as MCP tools. This gives AI agents (Claude Code, Cursor,\netc.) native tool access to OSAPI without HTTP boilerplate."}),"\n",(0,r.jsxs)(n.p,{children:["The MCP server will be a fourth server-type command alongside ",(0,r.jsx)(n.code,{children:"api server"}),",\n",(0,r.jsx)(n.code,{children:"node agent"}),", and ",(0,r.jsx)(n.code,{children:"nats server"}),", reusing the same ",(0,r.jsx)(n.code,{children:"JobClient"})," layer and\n",(0,r.jsx)(n.code,{children:"Lifecycle"})," pattern."]}),"\n",(0,r.jsx)(n.h2,{id:"design",children:"Design"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SDK"}),": ",(0,r.jsx)(n.code,{children:"github.com/modelcontextprotocol/go-sdk"})," (official Go MCP SDK)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transports"}),": stdio (default, for local AI tools) + streamable HTTP\n(flag-selected, for remote agents)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tool scope"}),": System + Network operations only (no job queue internals)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CLI"}),": ",(0,r.jsx)(n.code,{children:"osapi mcp server start [--transport http --port 3001]"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tools-5-total",children:"Tools (5 total)"}),"\n",(0,r.jsxs)(n.p,{children:["Each tool gets an optional ",(0,r.jsx)(n.code,{children:"target"})," parameter (defaults to ",(0,r.jsx)(n.code,{children:"_any"}),"). Broadcast\ntargets (",(0,r.jsx)(n.code,{children:"_all"}),", labels) return per-agent results."]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Tool"}),(0,r.jsx)(n.th,{children:"JobClient Method"}),(0,r.jsx)(n.th,{children:"Parameters"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"system_hostname_get"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"QuerySystemHostname"})," / ",(0,r.jsx)(n.code,{children:"Broadcast"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"target"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"system_status_get"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"QuerySystemStatus"})," / ",(0,r.jsx)(n.code,{children:"Broadcast"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"target"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"network_dns_get"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"QueryNetworkDNS"})," / ",(0,r.jsx)(n.code,{children:"Broadcast"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"target"}),", ",(0,r.jsx)(n.code,{children:"interface"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"network_dns_update"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"ModifyNetworkDNS"})," / ",(0,r.jsx)(n.code,{children:"Broadcast"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"target"}),", ",(0,r.jsx)(n.code,{children:"interface"}),", ",(0,r.jsx)(n.code,{children:"servers"}),", ",(0,r.jsx)(n.code,{children:"search_domains"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"network_ping"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"QueryNetworkPing"})," / ",(0,r.jsx)(n.code,{children:"Broadcast"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"target"}),", ",(0,r.jsx)(n.code,{children:"address"})]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"package-structure",children:"Package structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"internal/mcp/\n\u251c\u2500\u2500 server.go      # MCP server implementing cmd.Lifecycle\n\u251c\u2500\u2500 tools.go       # Tool registration and handlers\n\u2514\u2500\u2500 types.go       # Input structs for tools\n\ncmd/\n\u251c\u2500\u2500 mcp.go              # mcp command group\n\u251c\u2500\u2500 mcp_server.go       # mcp server subcommand group\n\u2514\u2500\u2500 mcp_server_start.go # mcp server start (NATS + JobClient + MCP wiring)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"config",children:"Config"}),"\n",(0,r.jsxs)(n.p,{children:["Add to ",(0,r.jsx)(n.code,{children:"internal/config/types.go"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'type MCP struct {\n    Server MCPServer `mapstructure:"server,omitempty"`\n}\n\ntype MCPServer struct {\n    Port int `mapstructure:"port"`\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Add to ",(0,r.jsx)(n.code,{children:"osapi.yaml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"mcp:\n  server:\n    port: 3001\n"})}),"\n",(0,r.jsx)(n.h2,{id:"files-to-createmodify",children:"Files to create/modify"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"File"}),(0,r.jsx)(n.th,{children:"Change"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"go.mod"})," / ",(0,r.jsx)(n.code,{children:"go.sum"})]}),(0,r.jsxs)(n.td,{children:["Add ",(0,r.jsx)(n.code,{children:"modelcontextprotocol/go-sdk"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/config/types.go"})}),(0,r.jsxs)(n.td,{children:["Add ",(0,r.jsx)(n.code,{children:"MCP"})," / ",(0,r.jsx)(n.code,{children:"MCPServer"})," types to ",(0,r.jsx)(n.code,{children:"Config"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"osapi.yaml"})}),(0,r.jsxs)(n.td,{children:["Add ",(0,r.jsx)(n.code,{children:"mcp.server.port"})," default"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/mcp/server.go"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"New"})," \u2014 MCP server with Lifecycle"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/mcp/tools.go"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"New"})," \u2014 tool registration + handlers"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/mcp/types.go"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"New"})," \u2014 input structs"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"cmd/mcp.go"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"New"})," \u2014 ",(0,r.jsx)(n.code,{children:"mcp"})," command group"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"cmd/mcp_server.go"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"New"})," \u2014 ",(0,r.jsx)(n.code,{children:"mcp server"})," subcommand"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"cmd/mcp_server_start.go"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"New"})," \u2014 ",(0,r.jsx)(n.code,{children:"mcp server start"})," command"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/mcp/server_public_test.go"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"New"})," \u2014 lifecycle tests"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal/mcp/tools_test.go"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"New"})," \u2014 tool handler tests"]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Tool handlers follow the same pattern as REST handlers in\n",(0,r.jsx)(n.code,{children:"internal/api/system/"})," \u2014 check ",(0,r.jsx)(n.code,{children:"job.IsBroadcastTarget()"}),", call the appropriate\n",(0,r.jsx)(n.code,{children:"JobClient"})," method, format results."]}),"\n",(0,r.jsx)(n.li,{children:"stdio transport is the standard for local AI tool integration. The server runs\nas a subprocess spawned by the AI tool."}),"\n",(0,r.jsx)(n.li,{children:"Streamable HTTP is for remote deployments (replaces deprecated SSE)."}),"\n",(0,r.jsxs)(n.li,{children:["The NATS embedded server's ",(0,r.jsx)(n.code,{children:"Stop()"})," doesn't need a context (internally\nbounded), so the adapter pattern from ",(0,r.jsx)(n.code,{children:"cmd/nats_server_start.go"})," applies only\nto that server, not here."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453(e,n,s){s.d(n,{R:()=>c,x:()=>o});var r=s(96540);const t={},d=r.createContext(t);function c(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);