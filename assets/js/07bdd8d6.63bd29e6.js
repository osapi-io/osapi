"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[324],{39565(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});var o=s(74848),t=s(28453);const d={title:"Audit and clean up mocks repo-wide",status:"done",created:new Date("2026-02-17T00:00:00.000Z"),updated:new Date("2026-02-18T00:00:00.000Z")},i=void 0,r={id:"sidebar/development/tasks/done/2026-02-17-test-mock-audit-cleanup",title:"Audit and clean up mocks repo-wide",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-17-test-mock-audit-cleanup.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-17-test-mock-audit-cleanup",permalink:"/osapi/sidebar/development/tasks/done/2026-02-17-test-mock-audit-cleanup",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Audit and clean up mocks repo-wide",status:"done",created:"2026-02-17T00:00:00.000Z",updated:"2026-02-18T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Achieve 100% test coverage on non-generated packages",permalink:"/osapi/sidebar/development/tasks/done/2026-02-17-test-coverage-100-percent"},next:{title:"Audit CLI commands and docs for consistency",permalink:"/osapi/sidebar/development/tasks/done/2026-02-18-docs-cli-docs-audit"}},c={},l=[{value:"Objective",id:"objective",level:2},{value:"Notes",id:"notes",level:2},{value:"Mockgen-generated mocks (15 files, 8 directories) -- all actively used",id:"mockgen-generated-mocks-15-files-8-directories----all-actively-used",level:3},{value:"Hand-written wrapper files (<code>mocks.go</code>) -- 7 files, all useful",id:"hand-written-wrapper-files-mocksgo----7-files-all-useful",level:3},{value:"Hand-rolled mocks -- 2 types, both appropriate to keep",id:"hand-rolled-mocks----2-types-both-appropriate-to-keep",level:3},{value:"Unused mocks -- none found",id:"unused-mocks----none-found",level:3},{value:"Assertion-based mocks -- none found",id:"assertion-based-mocks----none-found",level:3},{value:"Outcome",id:"outcome",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,o.jsxs)(n.p,{children:["Do a repo-wide audit of mocks with a focus on removing unused mocks and\neliminating hand-rolled assertion-based mocks when mockgen-generated mocks\nalready exist. The provider packages have many hand-written mocks in ",(0,o.jsx)(n.code,{children:"mocks.go"}),"\nfiles that may be unnecessary or could be replaced with mockgen or inline\ntest-table mocks."]}),"\n",(0,o.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,o.jsx)(n.h3,{id:"mockgen-generated-mocks-15-files-8-directories----all-actively-used",children:"Mockgen-generated mocks (15 files, 8 directories) -- all actively used"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Directory"}),(0,o.jsx)(n.th,{children:"Mocks"}),(0,o.jsx)(n.th,{children:"Used By"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"internal/job/mocks/"})}),(0,o.jsx)(n.td,{children:"NATSClient, KeyValue, KeyValueEntry, KeyWatcher, JobClient, NATSConnector, JetStream, JetStreamContext"}),(0,o.jsx)(n.td,{children:"job/client, job/worker, api/ tests"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"internal/exec/mocks/"})}),(0,o.jsx)(n.td,{children:"Manager"}),(0,o.jsx)(n.td,{children:"provider/network/dns tests"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"internal/provider/system/{host,disk,mem,load}/mocks/"})}),(0,o.jsx)(n.td,{children:"Provider (per domain)"}),(0,o.jsx)(n.td,{children:"job/worker tests"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"internal/provider/network/{dns,ping}/mocks/"})}),(0,o.jsx)(n.td,{children:"Provider, Pinger (ping only)"}),(0,o.jsx)(n.td,{children:"job/worker, provider tests"})]})]})]}),"\n",(0,o.jsxs)(n.h3,{id:"hand-written-wrapper-files-mocksgo----7-files-all-useful",children:["Hand-written wrapper files (",(0,o.jsx)(n.code,{children:"mocks.go"}),") -- 7 files, all useful"]}),"\n",(0,o.jsxs)(n.p,{children:["These provide ",(0,o.jsx)(n.code,{children:"NewPlainMockProvider()"})," / ",(0,o.jsx)(n.code,{children:"NewDefaultMockProvider()"})," factory\nfunctions that configure mockgen-generated mocks with sensible defaults. Good\npattern -- kept all of them."]}),"\n",(0,o.jsx)(n.h3,{id:"hand-rolled-mocks----2-types-both-appropriate-to-keep",children:"Hand-rolled mocks -- 2 types, both appropriate to keep"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"mockHostnameProvider"})})," in ",(0,o.jsx)(n.code,{children:"internal/job/hostname_test.go"})," -- simple stub\nfor 1-method internal interface, no mockgen needed"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"mockJetStreamMsg"})})," in ",(0,o.jsx)(n.code,{children:"internal/job/worker/consumer_test.go"})," -- minimal\nstub for 12-method external interface, only 2 methods matter, mockgen would\nadd noise"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"unused-mocks----none-found",children:"Unused mocks -- none found"}),"\n",(0,o.jsx)(n.h3,{id:"assertion-based-mocks----none-found",children:"Assertion-based mocks -- none found"}),"\n",(0,o.jsx)(n.h2,{id:"outcome",children:"Outcome"}),"\n",(0,o.jsx)(n.p,{children:"Audit complete. The codebase is clean:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"All 15 mockgen-generated mock files across 8 directories are actively\nreferenced by tests"}),"\n",(0,o.jsxs)(n.li,{children:["All 7 hand-written ",(0,o.jsx)(n.code,{children:"mocks.go"})," wrapper files provide useful factory functions\nand follow a consistent pattern"]}),"\n",(0,o.jsx)(n.li,{children:"The 2 hand-rolled mocks are justified (simple stubs where mockgen would be\noverkill)"}),"\n",(0,o.jsx)(n.li,{children:"No unused mocks, no assertion-based mocks, no inconsistencies found"}),"\n",(0,o.jsx)(n.li,{children:"No code changes required"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},28453(e,n,s){s.d(n,{R:()=>i,x:()=>r});var o=s(96540);const t={},d=o.createContext(t);function i(e){const n=o.useContext(d);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(d.Provider,{value:n},e.children)}}}]);