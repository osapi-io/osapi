"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5398],{86717(e,r,n){n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var s=n(74848),i=n(28453);const t={sidebar_position:1,sidebar_label:"Overview"},a="Architecture",o={id:"sidebar/architecture/architecture",title:"Architecture",description:"OSAPI turns Linux servers into managed appliances. You install a single binary,",source:"@site/docs/sidebar/architecture/architecture.md",sourceDirName:"sidebar/architecture",slug:"/sidebar/architecture/",permalink:"/osapi/sidebar/architecture/",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Overview"},sidebar:"testSidebar",previous:{title:"Metrics",permalink:"/osapi/sidebar/features/metrics"},next:{title:"System Architecture",permalink:"/osapi/sidebar/architecture/system-architecture"}},l={},d=[{value:"The Three Processes",id:"the-three-processes",level:2},{value:"NATS Server",id:"nats-server",level:3},{value:"API Server",id:"api-server",level:3},{value:"Worker",id:"worker",level:3},{value:"Deployment Models",id:"deployment-models",level:2},{value:"Single Host",id:"single-host",level:3},{value:"Multi-Host",id:"multi-host",level:3},{value:"How a Request Flows",id:"how-a-request-flows",level:2},{value:"Further Reading",id:"further-reading",level:2},{value:"Deep Dives",id:"deep-dives",level:2}];function c(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,s.jsx)(r.p,{children:"OSAPI turns Linux servers into managed appliances. You install a single binary,\npoint it at a config file, and get a REST API and CLI for querying and changing\nsystem configuration \u2014 hostname, DNS, disk usage, memory, load averages, and\nmore. State-changing operations run asynchronously through a job queue so the\nAPI server itself never needs root privileges."}),"\n",(0,s.jsx)(r.h2,{id:"the-three-processes",children:"The Three Processes"}),"\n",(0,s.jsx)(r.p,{children:"OSAPI has three runtime components. They can all run on the same host or be\nspread across many."}),"\n",(0,s.jsx)(r.h3,{id:"nats-server",children:"NATS Server"}),"\n",(0,s.jsxs)(r.p,{children:["A lightweight message broker that stores job state and routes messages between\nthe API server and workers. OSAPI embeds a NATS server with JetStream enabled,\nso you don't need to install anything extra \u2014 just run\n",(0,s.jsx)(r.code,{children:"osapi nats server start"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["For production deployments with multiple hosts, you can point everything at an\nexternal NATS cluster instead of the embedded one. Just change the ",(0,s.jsx)(r.code,{children:"nats.server"}),"\nsection in ",(0,s.jsx)(r.code,{children:"osapi.yaml"}),"."]}),"\n",(0,s.jsx)(r.h3,{id:"api-server",children:"API Server"}),"\n",(0,s.jsx)(r.p,{children:"An HTTP server that exposes a REST API. It handles authentication (JWT),\nvalidates requests, and translates them into jobs that get published to NATS.\nThe API server never executes system commands directly \u2014 it creates a job and\nreturns a job ID. Clients poll for results."}),"\n",(0,s.jsxs)(r.p,{children:["Start it with ",(0,s.jsx)(r.code,{children:"osapi api server start"}),"."]}),"\n",(0,s.jsx)(r.h3,{id:"worker",children:"Worker"}),"\n",(0,s.jsx)(r.p,{children:"A background process that subscribes to NATS, picks up jobs, and executes the\nactual system operations (reading hostname, querying DNS, checking disk usage,\netc.). Workers run with whatever privileges they have \u2014 if a worker can't read\nsomething due to permissions, it reports the error rather than failing silently."}),"\n",(0,s.jsxs)(r.p,{children:["Start it with ",(0,s.jsx)(r.code,{children:"osapi job worker start"}),"."]}),"\n",(0,s.jsx)(r.h2,{id:"deployment-models",children:"Deployment Models"}),"\n",(0,s.jsx)(r.h3,{id:"single-host",children:"Single Host"}),"\n",(0,s.jsx)(r.p,{children:"The simplest setup. All three processes run on the same machine:"}),"\n",(0,s.jsx)(r.mermaid,{value:'graph TD\n    subgraph host["Linux Host"]\n        CLI["CLI"]\n        API["API Server"]\n        Worker["Worker"]\n        NATS["NATS (embedded)"]\n\n        CLI --\x3e|HTTP| API\n        API --\x3e|publish job| NATS\n        NATS --\x3e|deliver job| Worker\n        Worker --\x3e|write result| NATS\n        API --\x3e|read result| NATS\n    end'}),"\n",(0,s.jsx)(r.p,{children:"The CLI on the same host talks to the API server over localhost. This is useful\nfor managing a single appliance or for development."}),"\n",(0,s.jsx)(r.h3,{id:"multi-host",children:"Multi-Host"}),"\n",(0,s.jsx)(r.p,{children:"For managing a fleet, run a shared NATS server (or cluster) and point multiple\nworkers at it. Each worker registers with its hostname and optional labels, and\nthe job routing system delivers work to the right place."}),"\n",(0,s.jsx)(r.mermaid,{value:'graph TD\n    CLI["CLI"]\n    API["API Server"]\n    NATS["NATS (shared)"]\n    W1["Worker (web-01)"]\n    W2["Worker (web-02)"]\n\n    CLI --\x3e|HTTP| API\n    API --\x3e|publish job| NATS\n    NATS --\x3e|deliver job| W1\n    NATS --\x3e|deliver job| W2\n    W1 --\x3e|write result| NATS\n    W2 --\x3e|write result| NATS\n    API --\x3e|read result| NATS'}),"\n",(0,s.jsx)(r.p,{children:"You can target jobs to specific hosts, broadcast to all, or route by label:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"--target _any"})," \u2014 send to any available worker (load balanced)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"--target _all"})," \u2014 send to every worker (broadcast)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"--target web-01"})," \u2014 send to a specific host"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"--target group:web.dev"})," \u2014 send to all workers with a matching label"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"how-a-request-flows",children:"How a Request Flows"}),"\n",(0,s.jsxs)(r.p,{children:["When you run a command like ",(0,s.jsx)(r.code,{children:"osapi client system hostname"}),":"]}),"\n",(0,s.jsx)(r.mermaid,{value:"sequenceDiagram\n    participant CLI\n    participant API as API Server\n    participant NATS\n    participant Worker\n\n    CLI->>API: POST /api/v1/jobs\n    API->>NATS: store job in KV\n    API->>NATS: publish notification\n    API--\x3e>CLI: 201 (job_id)\n    NATS->>Worker: deliver notification\n    Worker->>NATS: read job from KV\n    Worker->>Worker: execute operation\n    Worker->>NATS: write result to KV\n    CLI->>API: GET /api/v1/jobs/{id}\n    API->>NATS: read result from KV\n    API--\x3e>CLI: 200 (result)"}),"\n",(0,s.jsx)(r.p,{children:"The API server never touches the operating system directly. It's a thin\ncoordination layer between clients and workers."}),"\n",(0,s.jsx)(r.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsx)(r.p,{children:"For details on individual features \u2014 what they do, how they work, and how to\nconfigure them \u2014 see the Features section:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/features/system-management",children:"System Management"})," \u2014 hostname, disk,\nmemory, load"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/features/network-management",children:"Network Management"})," \u2014 DNS, ping"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/features/job-system",children:"Job System"})," \u2014 async job processing and routing"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/features/audit-logging",children:"Audit Logging"})," \u2014 API audit trail and export"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/features/health-checks",children:"Health Checks"})," \u2014 liveness, readiness, status"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/features/authentication",children:"Authentication & RBAC"})," \u2014 JWT, roles,\npermissions"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/features/distributed-tracing",children:"Distributed Tracing"})," \u2014 OpenTelemetry\nintegration"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/features/metrics",children:"Metrics"})," \u2014 Prometheus endpoint"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"deep-dives",children:"Deep Dives"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/architecture/system-architecture",children:"System Architecture"})," \u2014 package layout, handler\nstructure, provider pattern, and code-level details"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/architecture/job-architecture",children:"Job Architecture"})," \u2014 KV-first design, subject routing,\nworker pipeline, and multi-host processing"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/usage/configuration",children:"Configuration"})," \u2014 full ",(0,s.jsx)(r.code,{children:"osapi.yaml"})," reference with\nevery supported field"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/architecture/api-guidelines",children:"API Design Guidelines"})," \u2014 REST conventions and endpoint\npatterns"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/architecture/principles",children:"Guiding Principles"})," \u2014 design philosophy and project values"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/osapi/sidebar/development/",children:"Development"})," \u2014 setup, building, testing, and\ncontributing"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453(e,r,n){n.d(r,{R:()=>a,x:()=>o});var s=n(96540);const i={},t=s.createContext(i);function a(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);