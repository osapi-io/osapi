"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2763],{10770(e,s,n){n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var t=n(74848),r=n(28453);const i={title:"Verify multi-system routing and per-system response aggregation",status:"done",created:new Date("2026-02-15T00:00:00.000Z"),updated:new Date("2026-02-16T00:00:00.000Z")},o=void 0,c={id:"sidebar/development/tasks/done/2026-02-15-test-verify-multi-system-routing",title:"Verify multi-system routing and per-system response aggregation",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-15-test-verify-multi-system-routing.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-15-test-verify-multi-system-routing",permalink:"/osapi/sidebar/development/tasks/done/2026-02-15-test-verify-multi-system-routing",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Verify multi-system routing and per-system response aggregation",status:"done",created:"2026-02-15T00:00:00.000Z",updated:"2026-02-16T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"Consistency pass and test coverage audit",permalink:"/osapi/sidebar/development/tasks/done/2026-02-15-test-consistency-audit"},next:{title:"Implement broadcast (_all) response collection",permalink:"/osapi/sidebar/development/tasks/done/2026-02-16-feat-broadcast-response-collection"}},l={},a=[{value:"Objective",id:"objective",level:2},{value:"Key Questions to Verify",id:"key-questions-to-verify",level:2},{value:"Architecture Reference",id:"architecture-reference",level:2},{value:"What to Verify",id:"what-to-verify",level:2},{value:"Acceptance Criteria",id:"acceptance-criteria",level:2},{value:"Outcome",id:"outcome",level:2}];function d(e){const s={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"objective",children:"Objective"}),"\n",(0,t.jsx)(s.p,{children:"Verify that the job system architecture correctly supports routing messages to a\nsingle system or multiple systems, and that responses are aggregated per-system\nso consumers can see what each individual system reported back."}),"\n",(0,t.jsx)(s.h2,{id:"key-questions-to-verify",children:"Key Questions to Verify"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Single-system routing (",(0,t.jsx)(s.code,{children:"_any"}),")"]}),": Does a job targeted at ",(0,t.jsx)(s.code,{children:"_any"})," get picked\nup by exactly one worker and return that worker's response?"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Multi-system routing (",(0,t.jsx)(s.code,{children:"_all"}),")"]}),": Does a job targeted at ",(0,t.jsx)(s.code,{children:"_all"})," get\nbroadcast to all workers, and do all workers process independently?"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Per-system responses"}),": When multiple systems process the same job, can the\nclient see each system's individual response (hostname, result, status,\ntiming)?"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Specific-host routing (",(0,t.jsx)(s.code,{children:"hostname"}),")"]}),": Does a job targeted at a specific\nhostname only get processed by that worker?"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Response aggregation"}),": For ",(0,t.jsx)(s.code,{children:"_all"})," jobs, does the status computation\ncorrectly show ",(0,t.jsx)(s.code,{children:"partial_failure"})," when some systems succeed and others fail?"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"architecture-reference",children:"Architecture Reference"}),"\n",(0,t.jsxs)(s.p,{children:["The append-only status architecture (",(0,t.jsx)(s.code,{children:"docs/docs/sidebar/architecture.md"}),")\nalready describes:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"status.{job-id}.{event}.{hostname}.{nano}"})," for per-worker status events"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"responses.{job-id}.{hostname}.{nano}"})," for per-worker responses"]}),"\n",(0,t.jsx)(s.li,{children:"Computed status from events (completed, partial_failure, failed)"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"what-to-verify",children:"What to Verify"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Walk through the code path from ",(0,t.jsx)(s.code,{children:"CreateJob"})," through subject routing\n(",(0,t.jsx)(s.code,{children:"jobs.{type}.{hostname}"}),") to worker subscription patterns"]}),"\n",(0,t.jsxs)(s.li,{children:["Verify ",(0,t.jsx)(s.code,{children:"_all"})," broadcast works without queue groups"]}),"\n",(0,t.jsxs)(s.li,{children:["Verify ",(0,t.jsx)(s.code,{children:"_any"})," load balancing works with queue groups"]}),"\n",(0,t.jsx)(s.li,{children:"Verify the response KV keys include hostname for per-system attribution"}),"\n",(0,t.jsxs)(s.li,{children:["Verify ",(0,t.jsx)(s.code,{children:"GetJobStatus"})," aggregates multi-worker responses correctly"]}),"\n",(0,t.jsxs)(s.li,{children:["Consider whether the REST API ",(0,t.jsx)(s.code,{children:"GET /job/{id}"})," response needs enhancement to\nreturn a list of per-worker results for ",(0,t.jsx)(s.code,{children:"_all"})," jobs (currently returns single\nhostname/result)"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"acceptance-criteria",children:"Acceptance Criteria"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Document any gaps found between the architecture doc and implementation"}),"\n",(0,t.jsx)(s.li,{children:"If gaps exist, create follow-up tasks to fix them"}),"\n",(0,t.jsx)(s.li,{children:"Ensure integration tests or manual testing cover single-host, any-host, and\nall-host routing scenarios"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"outcome",children:"Outcome"}),"\n",(0,t.jsxs)(s.p,{children:["Architecture verification confirmed routing is ",(0,t.jsx)(s.strong,{children:"correct"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"_any"})," \u2192 queue groups (load balanced via NATS consumer)"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"_all"})," \u2192 no queue groups (broadcast to all workers)"]}),"\n",(0,t.jsx)(s.li,{children:"Direct hostname \u2192 filtered consumer on specific host"}),"\n",(0,t.jsx)(s.li,{children:"Append-only events with nanosecond timestamps eliminate race conditions"}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"partial_failure"})," status aggregation works correctly"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Gaps identified"})," (follow-up task created):"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"QuerySystemStatusAll"})," is a stub \u2014 ",(0,t.jsx)(s.code,{children:"_all"})," broadcast response collection is not\nyet implemented"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"publishAndWait"})," only collects the first response"]}),"\n",(0,t.jsxs)(s.li,{children:["REST API ",(0,t.jsx)(s.code,{children:"GET /job/{id}"})," returns a single result, not per-worker results"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["See: ",(0,t.jsx)(s.code,{children:".tasks/backlog/2026-02-16-broadcast-response-collection.md"})]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453(e,s,n){n.d(s,{R:()=>o,x:()=>c});var t=n(96540);const r={},i=t.createContext(r);function o(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);