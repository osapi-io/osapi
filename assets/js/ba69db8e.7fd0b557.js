"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[132],{44250(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>c});var r=i(74848),s=i(28453);const t={sidebar_position:6},o="Authentication & RBAC",d={id:"sidebar/features/authentication",title:"Authentication & RBAC",description:"OSAPI uses JWT bearer tokens for authentication and fine-grained resource:verb",source:"@site/docs/sidebar/features/authentication.md",sourceDirName:"sidebar/features",slug:"/sidebar/features/authentication",permalink:"/osapi/sidebar/features/authentication",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"testSidebar",previous:{title:"Health Checks",permalink:"/osapi/sidebar/features/health-checks"},next:{title:"Distributed Tracing",permalink:"/osapi/sidebar/features/distributed-tracing"}},a={},c=[{value:"How It Works",id:"how-it-works",level:2},{value:"JWT Signing",id:"jwt-signing",level:3},{value:"Token Structure",id:"token-structure",level:3},{value:"Permission Resolution",id:"permission-resolution",level:3},{value:"Roles and Permissions",id:"roles-and-permissions",level:2},{value:"Custom Roles",id:"custom-roles",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Related",id:"related",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"authentication--rbac",children:"Authentication & RBAC"})}),"\n",(0,r.jsxs)(n.p,{children:["OSAPI uses JWT bearer tokens for authentication and fine-grained ",(0,r.jsx)(n.code,{children:"resource:verb"}),"\npermissions for authorization. Every API endpoint (except health probes)\nrequires a valid token."]}),"\n",(0,r.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsx)(n.h3,{id:"jwt-signing",children:"JWT Signing"}),"\n",(0,r.jsxs)(n.p,{children:["OSAPI uses ",(0,r.jsx)(n.strong,{children:"HMAC-SHA256 (HS256)"})," symmetric signing. The same ",(0,r.jsx)(n.code,{children:"signing_key"})," is\nused to both create and verify tokens:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"osapi token generate \u2500\u2500[signs with signing_key]\u2500\u2500> JWT\nClient \u2500\u2500[sends JWT]\u2500\u2500> API Server \u2500\u2500[verifies with signing_key]\u2500\u2500> Allow/Deny\n"})}),"\n",(0,r.jsx)(n.p,{children:"Only someone who knows the signing key can create valid tokens. If the signing\nkey is compromised, rotate it immediately -- all previously issued tokens become\ninvalid."}),"\n",(0,r.jsx)(n.h3,{id:"token-structure",children:"Token Structure"}),"\n",(0,r.jsx)(n.p,{children:"A token carries three pieces of authorization data:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Roles"})," (",(0,r.jsx)(n.code,{children:"roles"})," claim, required) -- one or more of ",(0,r.jsx)(n.code,{children:"admin"}),", ",(0,r.jsx)(n.code,{children:"write"}),", ",(0,r.jsx)(n.code,{children:"read"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Permissions"})," (",(0,r.jsx)(n.code,{children:"permissions"})," claim, optional) -- direct ",(0,r.jsx)(n.code,{children:"resource:verb"}),"\ngrants that override role expansion"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subject"})," (",(0,r.jsx)(n.code,{children:"sub"})," claim) -- user identity for audit logging"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Generate tokens with the CLI. See ",(0,r.jsx)(n.a,{href:"/osapi/sidebar/usage/cli/token/",children:"CLI Reference"}),"\nfor usage and examples, or the ",(0,r.jsx)(n.a,{href:"/category/api",children:"API Reference"})," for the REST\nendpoints."]}),"\n",(0,r.jsx)(n.h3,{id:"permission-resolution",children:"Permission Resolution"}),"\n",(0,r.jsx)(n.p,{children:"When a request arrives, the middleware resolves the caller's effective\npermissions:"}),"\n",(0,r.jsx)(n.mermaid,{value:"flowchart TD\n    A[Request with JWT] --\x3e B{Token has<br/>permissions claim?}\n    B --\x3e|Yes| C[Use permissions directly]\n    B --\x3e|No| D{Custom role<br/>defined?}\n    D --\x3e|Yes| E[Expand custom role permissions]\n    D --\x3e|No| F[Expand default role permissions]\n    E --\x3e G{Required permission<br/>in set?}\n    F --\x3e G\n    C --\x3e G\n    G --\x3e|Yes| H[Allow]\n    G --\x3e|No| I[403 Forbidden]"}),"\n",(0,r.jsx)(n.h2,{id:"roles-and-permissions",children:"Roles and Permissions"}),"\n",(0,r.jsx)(n.p,{children:"Built-in roles expand to these default permissions:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Role"}),(0,r.jsx)(n.th,{children:"Permissions"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"admin"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"node:read"}),", ",(0,r.jsx)(n.code,{children:"network:read"}),", ",(0,r.jsx)(n.code,{children:"network:write"}),", ",(0,r.jsx)(n.code,{children:"job:read"}),", ",(0,r.jsx)(n.code,{children:"job:write"}),", ",(0,r.jsx)(n.code,{children:"health:read"}),", ",(0,r.jsx)(n.code,{children:"audit:read"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"write"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"node:read"}),", ",(0,r.jsx)(n.code,{children:"network:read"}),", ",(0,r.jsx)(n.code,{children:"network:write"}),", ",(0,r.jsx)(n.code,{children:"job:read"}),", ",(0,r.jsx)(n.code,{children:"job:write"}),", ",(0,r.jsx)(n.code,{children:"health:read"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"read"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"node:read"}),", ",(0,r.jsx)(n.code,{children:"network:read"}),", ",(0,r.jsx)(n.code,{children:"job:read"}),", ",(0,r.jsx)(n.code,{children:"health:read"})]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"custom-roles",children:"Custom Roles"}),"\n",(0,r.jsx)(n.p,{children:"Define custom roles in the configuration to create new role names or override\ndefault permission mappings:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"api:\n  server:\n    security:\n      roles:\n        ops:\n          permissions:\n            - node:read\n            - health:read\n        netadmin:\n          permissions:\n            - network:read\n            - network:write\n            - health:read\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"api:\n  server:\n    security:\n      # HS256 signing key (REQUIRED)\n      # Generate with: openssl rand -hex 32\n      signing_key: '<64-char hex string>'\n\n  client:\n    security:\n      # JWT for client requests (REQUIRED)\n      # Generate with: osapi token generate\n      bearer_token: '<jwt>'\n"})}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/osapi/sidebar/usage/configuration#permissions",children:"Configuration"})," for the full\nreference including custom roles and CORS settings."]}),"\n",(0,r.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/osapi/sidebar/usage/cli/token/",children:"CLI Reference"})," -- token generation and\nvalidation commands"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/category/api",children:"API Reference"})," -- REST API documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/osapi/sidebar/usage/configuration",children:"Configuration"})," -- full configuration reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/osapi/sidebar/architecture/",children:"Architecture"})," -- system design overview"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453(e,n,i){i.d(n,{R:()=>o,x:()=>d});var r=i(96540);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);