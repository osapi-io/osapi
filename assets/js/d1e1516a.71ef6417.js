"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5925],{78783(e,s,n){n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var r=n(74848),o=n(28453);const t={title:"Show worker labels in system hostname output",status:"done",created:new Date("2026-02-21T00:00:00.000Z"),updated:new Date("2026-02-21T00:00:00.000Z")},i=void 0,l={id:"sidebar/development/tasks/done/2026-02-21-feat-show-worker-labels",title:"Show worker labels in system hostname output",description:"Objective",source:"@site/docs/sidebar/development/tasks/done/2026-02-21-feat-show-worker-labels.md",sourceDirName:"sidebar/development/tasks/done",slug:"/sidebar/development/tasks/done/2026-02-21-feat-show-worker-labels",permalink:"/osapi/sidebar/development/tasks/done/2026-02-21-feat-show-worker-labels",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Show worker labels in system hostname output",status:"done",created:"2026-02-21T00:00:00.000Z",updated:"2026-02-21T00:00:00.000Z"},sidebar:"testSidebar",previous:{title:"RBAC enforcement with fine-grained permissions",permalink:"/osapi/sidebar/development/tasks/done/2026-02-21-feat-rbac-enforcement"},next:{title:"Surface failed worker responses in broadcast query results",permalink:"/osapi/sidebar/development/tasks/done/2026-02-21-fix-broadcast-silent-failures"}},d={},a=[{value:"Objective",id:"objective",level:2},{value:"Current Behavior",id:"current-behavior",level:2},{value:"Desired Behavior",id:"desired-behavior",level:2},{value:"Notes",id:"notes",level:2},{value:"Outcome",id:"outcome",level:2}];function c(e){const s={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"objective",children:"Objective"}),"\n",(0,r.jsxs)(s.p,{children:["When running ",(0,r.jsx)(s.code,{children:"osapi client system hostname"})," (especially with ",(0,r.jsx)(s.code,{children:"--target _all"}),"),\ninclude the labels each worker belongs to. This gives operators visibility into\nhow their fleet is organized without having to cross-reference worker configs."]}),"\n",(0,r.jsx)(s.h2,{id:"current-behavior",children:"Current Behavior"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 HOSTNAME \u2503\n\u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252b\n\u2503 server1  \u2503\n\u2503 server2  \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n"})}),"\n",(0,r.jsx)(s.h2,{id:"desired-behavior",children:"Desired Behavior"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 HOSTNAME \u2503 LABELS              \u2503\n\u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u254b\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252b\n\u2503 server1  \u2503 group:web.dev       \u2503\n\u2503 server2  \u2503 group:db.prod       \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u253b\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n"})}),"\n",(0,r.jsx)(s.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The worker already sends labels in the ",(0,r.jsx)(s.code,{children:"hostname.get"})," response (see\n",(0,r.jsx)(s.code,{children:"ListWorkers"})," in ",(0,r.jsx)(s.code,{children:"internal/job/client/query.go"})," which parses ",(0,r.jsx)(s.code,{children:"labels"})," from the\nresponse). The hostname query handler may just need to include labels in its\nresponse data."]}),"\n",(0,r.jsxs)(s.li,{children:["Check ",(0,r.jsx)(s.code,{children:"internal/job/worker/processor.go"})," to see if the hostname processor\nalready returns labels or if it needs to be added."]}),"\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.code,{children:"job list workers"})," command already shows labels \u2014 reuse that pattern."]}),"\n",(0,r.jsx)(s.li,{children:"For single-host output, labels could be shown as a key-value line below\nhostname rather than a table column."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"outcome",children:"Outcome"}),"\n",(0,r.jsx)(s.p,{children:"Implemented across the full stack. Labels now flow from worker responses through\nthe API and are displayed in CLI output:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"OpenAPI spec"})," (",(0,r.jsx)(s.code,{children:"internal/api/system/gen/api.yaml"}),"): Added optional ",(0,r.jsx)(s.code,{children:"labels"}),"\nfield to ",(0,r.jsx)(s.code,{children:"SystemHostnameResult"})," schema."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Job client"})," (",(0,r.jsx)(s.code,{children:"internal/job/client/query.go"}),", ",(0,r.jsx)(s.code,{children:"types.go"}),"): ",(0,r.jsx)(s.code,{children:"WorkerInfo"}),"\nstruct carries hostname and labels; returned from ",(0,r.jsx)(s.code,{children:"QuerySystemHostname"})," and\n",(0,r.jsx)(s.code,{children:"QuerySystemHostnameBroadcast"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"API handler"})," (",(0,r.jsx)(s.code,{children:"internal/api/system/system_hostname_get.go"}),"): Maps\n",(0,r.jsx)(s.code,{children:"WorkerInfo.Labels"})," into the response."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"CLI"})," (",(0,r.jsx)(s.code,{children:"cmd/client_system_hostname_get.go"}),", ",(0,r.jsx)(s.code,{children:"cmd/ui.go"}),"): Single-host shows\n",(0,r.jsx)(s.code,{children:"Labels: key:val"})," via ",(0,r.jsx)(s.code,{children:"printKV"}),"; broadcast table adds a LABELS column via\n",(0,r.jsx)(s.code,{children:"formatLabels"})," helper."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Tests"}),": All four test files audited and confirmed to follow repo\nconventions (suite, table-driven, domain-appropriate assertion patterns)."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453(e,s,n){n.d(s,{R:()=>i,x:()=>l});var r=n(96540);const o={},t=r.createContext(o);function i(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);