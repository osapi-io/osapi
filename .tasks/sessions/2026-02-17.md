---
date: 2026-02-17
---

## Summary

Implemented broadcast response collection for `_all` jobs, completing all
gaps identified in the 2026-02-16 task.

## Changes

- `internal/job/client/client.go` — Added `publishAndCollect()` method
  that waits full timeout and collects all worker responses into a map
  keyed by hostname.
- `internal/job/client/query.go` — Replaced `QuerySystemStatusAll` stub
  with working implementation using `publishAndCollect` and `_all`
  subject.
- `internal/job/client/types.go` — Added `QuerySystemStatusAll` to
  `JobClient` interface.
- `internal/job/client/jobs.go` — Fixed `GetJobStatus` to populate
  `Hostname` from computed status and `Result` from single-worker
  response.
- `internal/api/job/gen/api.yaml` — Added `responses` and
  `worker_states` fields to `JobDetailResponse` schema.
- `internal/api/job/job_get.go` — Updated `GetJobByID` handler to map
  per-worker responses and worker states to the API response.
- `internal/job/client/helpers_test.go` — Added
  `publishAndCollectMockOpts` and `setupPublishAndCollectMocks` helper.
- `internal/job/client/query_public_test.go` — Replaced stub test with
  7 table-driven test cases for `QuerySystemStatusAll`.
- `internal/api/job/job_get_public_test.go` — Added 3 test cases for
  broadcast jobs with multiple responses/worker states.
- Regenerated `internal/api/job/gen/job.gen.go` and
  `internal/job/mocks/job_client.gen.go`.

## Decisions

- Used full timeout wait strategy (collect all responses until timeout,
  then return what was collected).
- `responses` map only exposed in API when there are >1 responses
  (single-worker jobs use the existing `result` field).
- Failed worker responses are skipped in `QuerySystemStatusAll` but
  still exposed in the REST API `responses` map.

## Next Steps

- Pick up next task from `.tasks/backlog/`.
