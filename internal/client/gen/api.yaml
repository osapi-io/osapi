openapi: 3.0.0
info:
  title: OSAPI - A CRUD API for managing Linux systems
  description: |
    OSAPI is a lightweight, minimalistic RESTful API designed to manage and
    configure Linux systems as appliances. The API provides comprehensive
    management capabilities, including reading the current state of the system
    and making privileged, asynchronous changes to match a desired configuration
    state.

    OSAPI is built with pluggability and extensibility in mind, allowing it to
    adapt to different Linux distributions and environments by implementing
    custom handlers for various system operations.

    Key Features:
    - **RESTful API Design:** A RESTful approach for managing Linux systems,
      enabling clear and organized endpoints for system configurations,
      diagnostics, and state management.
    - **Pluggable Architecture:** Easily extend or replace components to suit
      different Linux environments. This flexibility allows users to customize
      behavior based on specific distribution requirements or operational needs.
    - **Job System for Privileged Actions:** Asynchronous job execution via
      NATS JetStream to perform system modifications securely, ensuring that
      changes are managed in a controlled and orderly manner.
    - **System Information Gathering:** Provides detailed system insights, such
      as OS details, hostname, and other environment-specific information,
      facilitating diagnostics and monitoring.
    - **CLI Equivalence:** All functionalities accessible via the API are also
      available through an equivalent command-line interface, making the tool
      adaptable to both programmatic and manual use cases.
    - **Written in Go:** The API and its supporting tools are written in Go,
      ensuring high performance, low resource usage, and easy cross-platform
      deployment.
  version: 1.0.0
  contact:
    url: https://github.com/retr0h/osapi
  license:
    name: MIT License
    url: https://opensource.org/licenses/MIT
tags:
  - name: OSAPI_-_A_CRUD_API_for_managing_Linux_systems_info
    x-displayName: Info
    description: Operations related to the info endpoint.
  - name: Health_Check_API_health
    x-displayName: Health
    description: Health check endpoints for liveness, readiness, and detailed status.
  - name: Job_Management_API_job_operations
    x-displayName: Job
    description: Operations related to the job queue.
  - name: Network_Management_API_network_operations
    x-displayName: Network
    description: Operations related to the network endpoint.
  - name: Network_Management_API_dns_operations
    x-displayName: Network/DNS
    description: Operations related to DNS configuration.
  - name: System_Management_API_system_operations
    x-displayName: System
    description: Operations related to the system endpoint.
  - name: System_Management_API_system_status
    x-displayName: System/Status
    description: Operations related to system status endpoint.
paths:
  /version:
    servers:
      - url: http://127.0.0.1:8080
        description: Mock API (local).
    get:
      summary: Retrieve the software version
      description: Get the current version of the software running on the system.
      tags:
        - OSAPI_-_A_CRUD_API_for_managing_Linux_systems_info
      responses:
        '400':
          description: A common JSON error response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /health:
    servers: []
    get:
      operationId: GetHealth
      summary: Liveness probe
      description: Returns 200 if the process is alive. No checks performed.
      tags:
        - Health_Check_API_health
      responses:
        '200':
          description: Process is alive.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /health/ready:
    servers: []
    get:
      operationId: GetHealthReady
      summary: Readiness probe
      description: Returns 200 when the service is ready to accept traffic.
      tags:
        - Health_Check_API_health
      responses:
        '200':
          description: Service is ready.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadyResponse'
        '503':
          description: Service is not ready.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadyResponse'
  /health/status:
    servers: []
    get:
      operationId: GetHealthStatus
      summary: System status and component health
      description: >-
        Returns per-component health status with system metrics. Requires
        authentication.
      tags:
        - Health_Check_API_health
      security:
        - BearerAuth:
            - health:read
      responses:
        '200':
          description: All components healthy.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '401':
          description: Unauthorized - API key required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: One or more components unhealthy.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
  /job:
    servers: []
    post:
      summary: Create a new job
      description: Submit a new job to the queue for processing.
      tags:
        - Job_Management_API_job_operations
      security:
        - BearerAuth:
            - job:write
      requestBody:
        description: The job to create.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJobRequest'
      responses:
        '201':
          description: The job was created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateJobResponse'
        '400':
          description: Invalid request payload.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error creating job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      summary: List jobs
      description: Retrieve jobs, optionally filtered by status.
      tags:
        - Job_Management_API_job_operations
      security:
        - BearerAuth:
            - job:read
      parameters:
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum:
              - submitted
              - processing
              - completed
              - failed
              - partial_failure
            x-oapi-codegen-extra-tags:
              validate: >-
                omitempty,oneof=submitted processing completed failed
                partial_failure
          description: Filter jobs by status.
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 10
            x-oapi-codegen-extra-tags:
              validate: omitempty,min=0
          description: Maximum number of jobs to return. Use 0 for no limit.
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
            x-oapi-codegen-extra-tags:
              validate: omitempty,min=0
          description: Number of jobs to skip for pagination.
      responses:
        '200':
          description: A list of jobs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListJobsResponse'
        '400':
          description: Invalid request parameters.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error listing jobs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /job/status:
    servers: []
    get:
      summary: Get queue statistics
      description: Retrieve statistics about the job queue.
      tags:
        - Job_Management_API_job_operations
      security:
        - BearerAuth:
            - job:read
      responses:
        '200':
          description: Queue statistics.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueStatsResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error retrieving queue statistics.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /job/workers:
    servers: []
    get:
      summary: List active workers
      description: >-
        Discover all active workers in the fleet by broadcasting a hostname
        query.
      tags:
        - Job_Management_API_job_operations
      security:
        - BearerAuth:
            - job:read
      responses:
        '200':
          description: List of active workers.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListWorkersResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error discovering workers.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /job/{id}:
    servers: []
    get:
      summary: Get job detail
      description: Retrieve details of a specific job by its ID.
      tags:
        - Job_Management_API_job_operations
      operationId: GetJobByID
      security:
        - BearerAuth:
            - job:read
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the job to retrieve.
          schema:
            type: string
            format: uuid
            x-oapi-codegen-extra-tags:
              validate: required,uuid
      responses:
        '200':
          description: The job details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobDetailResponse'
        '400':
          description: Invalid request parameters.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error retrieving job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete a job
      description: Delete a specific job by its ID.
      tags:
        - Job_Management_API_job_operations
      operationId: DeleteJobByID
      security:
        - BearerAuth:
            - job:write
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the job to delete.
          schema:
            type: string
            format: uuid
            x-oapi-codegen-extra-tags:
              validate: required,uuid
      responses:
        '204':
          description: Job deleted successfully. No content returned.
        '400':
          description: Invalid request parameters.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error deleting job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /job/{id}/retry:
    servers: []
    post:
      summary: Retry a job
      description: >-
        Create a new job using the same operation data as an existing job. The
        original job is preserved. Returns the new job ID.
      tags:
        - Job_Management_API_job_operations
      operationId: RetryJobByID
      security:
        - BearerAuth:
            - job:write
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the job to retry.
          schema:
            type: string
            format: uuid
            x-oapi-codegen-extra-tags:
              validate: required,uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RetryJobRequest'
      responses:
        '201':
          description: The retry job was created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateJobResponse'
        '400':
          description: Invalid request parameters.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error retrying job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /network/ping:
    servers: []
    post:
      summary: Ping a remote server
      description: Send a ping to a remote server to verify network connectivity.
      tags:
        - Network_Management_API_network_operations
      security:
        - BearerAuth:
            - network:write
      parameters:
        - name: target_hostname
          in: query
          required: false
          schema:
            type: string
            default: _any
          description: >
            Target: _any (load-balanced), _all (broadcast), hostname (direct),
            or key:value (label group, e.g., group:web.dev).
      requestBody:
        description: The server to ping.
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                address:
                  type: string
                  description: >-
                    The IP address of the server to ping. Supports both IPv4 and
                    IPv6.
                  example: 8.8.8.8
                  x-oapi-codegen-extra-tags:
                    validate: required,ip
              required:
                - address
      responses:
        '200':
          description: Successful ping response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PingCollectionResponse'
        '400':
          description: Invalid request payload.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error performing the ping operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /network/dns/{interfaceName}:
    servers: []
    get:
      summary: List DNS servers
      description: >-
        Retrieve the list of currently configured DNS servers for a specific
        network interface.
      tags:
        - Network_Management_API_dns_operations
      operationId: GetNetworkDNSByInterface
      security:
        - BearerAuth:
            - network:read
      parameters:
        - name: interfaceName
          in: path
          required: true
          schema:
            type: string
            x-oapi-codegen-extra-tags:
              validate: required,alphanum
          description: >
            The name of the network interface to retrieve DNS configuration for.
            Must only contain letters and numbers.
        - name: target_hostname
          in: query
          required: false
          schema:
            type: string
            default: _any
          description: >
            Target: _any (load-balanced), _all (broadcast), hostname (direct),
            or key:value (label group, e.g., group:web.dev).
      responses:
        '200':
          description: List of DNS servers.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DNSConfigCollectionResponse'
        '400':
          description: Invalid interface name provided.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error retrieving DNS servers.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /network/dns:
    servers: []
    put:
      summary: Update DNS servers
      description: Update the system's DNS server configuration.
      tags:
        - Network_Management_API_dns_operations
      operationId: PutNetworkDNS
      security:
        - BearerAuth:
            - network:write
      parameters:
        - name: target_hostname
          in: query
          required: false
          schema:
            type: string
            default: _any
          description: >
            Target: _any (load-balanced), _all (broadcast), hostname (direct),
            or key:value (label group, e.g., group:web.dev).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DNSConfigUpdateRequest'
      responses:
        '202':
          description: DNS servers update successfully accepted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DNSUpdateCollectionResponse'
        '400':
          description: Invalid input.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error updating DNS servers.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /system/status:
    servers: []
    get:
      summary: Retrieve system status
      description: >-
        Get the current status of the system including hostname, uptime, load
        averages, memory, and disk usage.
      tags:
        - System_Management_API_system_status
      security:
        - BearerAuth:
            - system:read
      parameters:
        - name: target_hostname
          in: query
          required: false
          schema:
            type: string
            default: _any
          description: >
            Target: _any (load-balanced), _all (broadcast), hostname (direct),
            or key:value (label group, e.g., group:web.dev).
      responses:
        '200':
          description: A JSON object containing the system's status information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStatusCollectionResponse'
        '400':
          description: Invalid request parameters.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error retrieving system status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /system/hostname:
    servers: []
    get:
      summary: Retrieve system hostname
      description: Get the current hostname of the system.
      tags:
        - System_Management_API_system_operations
      security:
        - BearerAuth:
            - system:read
      parameters:
        - name: target_hostname
          in: query
          required: false
          schema:
            type: string
            default: _any
          description: >
            Target: _any (load-balanced), _all (broadcast), hostname (direct),
            or key:value (label group, e.g., group:web.dev).
      responses:
        '200':
          description: A JSON object containing the system's hostname.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HostnameCollectionResponse'
        '400':
          description: Invalid request parameters.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - API key required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error retrieving hostname.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: A description of the error that occurred.
          example: Failed to retrieve status.
        details:
          type: string
          description: Additional details about the error.
          example: Failed due to network timeout.
        code:
          type: integer
          description: The error code.
          example: 500
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          description: Health status.
          example: ok
      required:
        - status
    ReadyResponse:
      type: object
      properties:
        status:
          type: string
          description: Readiness status.
          example: ready
        error:
          type: string
          description: Error message when not ready.
      required:
        - status
    ComponentHealth:
      type: object
      properties:
        status:
          type: string
          description: Component health status.
          example: ok
        error:
          type: string
          description: Error message when component is unhealthy.
      required:
        - status
    NATSInfo:
      type: object
      properties:
        url:
          type: string
          description: Connected NATS server URL.
          example: nats://localhost:4222
        version:
          type: string
          description: NATS server version.
          example: 2.10.0
      required:
        - url
        - version
    StreamInfo:
      type: object
      properties:
        name:
          type: string
          description: Stream name.
          example: JOBS
        messages:
          type: integer
          description: Number of messages in the stream.
          example: 42
        bytes:
          type: integer
          description: Total bytes in the stream.
          example: 1024
        consumers:
          type: integer
          description: Number of consumers on the stream.
          example: 1
      required:
        - name
        - messages
        - bytes
        - consumers
    KVBucketInfo:
      type: object
      properties:
        name:
          type: string
          description: KV bucket name.
          example: job-queue
        keys:
          type: integer
          description: Number of keys in the bucket.
          example: 10
        bytes:
          type: integer
          description: Total bytes in the bucket.
          example: 2048
      required:
        - name
        - keys
        - bytes
    JobStats:
      type: object
      properties:
        total:
          type: integer
          description: Total number of jobs.
          example: 100
        unprocessed:
          type: integer
          description: Number of unprocessed jobs.
          example: 5
        processing:
          type: integer
          description: Number of jobs currently processing.
          example: 2
        completed:
          type: integer
          description: Number of completed jobs.
          example: 90
        failed:
          type: integer
          description: Number of failed jobs.
          example: 3
        dlq:
          type: integer
          description: Number of jobs in the dead letter queue.
          example: 0
      required:
        - total
        - unprocessed
        - processing
        - completed
        - failed
        - dlq
    StatusResponse:
      type: object
      properties:
        status:
          type: string
          description: Overall health status.
          example: ok
        components:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ComponentHealth'
          description: Per-component health status.
        version:
          type: string
          description: Application version.
          example: 0.1.0
        uptime:
          type: string
          description: Time since server started.
          example: 2h30m
        nats:
          $ref: '#/components/schemas/NATSInfo'
        streams:
          type: array
          items:
            $ref: '#/components/schemas/StreamInfo'
          description: JetStream stream statistics.
        kv_buckets:
          type: array
          items:
            $ref: '#/components/schemas/KVBucketInfo'
          description: KV bucket statistics.
        jobs:
          $ref: '#/components/schemas/JobStats'
      required:
        - status
        - components
        - version
        - uptime
    CreateJobRequest:
      type: object
      properties:
        operation:
          type: object
          description: The operation to perform, as a JSON object.
          additionalProperties: true
          x-oapi-codegen-extra-tags:
            validate: required
        target_hostname:
          type: string
          description: The target hostname for routing (_any, _all, or specific hostname).
          example: _any
          x-oapi-codegen-extra-tags:
            validate: required,min=1
      required:
        - operation
        - target_hostname
    CreateJobResponse:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
          description: Unique identifier for the created job.
          example: 550e8400-e29b-41d4-a716-446655440000
        status:
          type: string
          description: Initial status of the job.
          example: unprocessed
        revision:
          type: integer
          format: int64
          description: The KV revision number.
          example: 1
        timestamp:
          type: string
          description: Creation timestamp.
          example: '2025-06-14T10:00:00Z'
      required:
        - job_id
        - status
    RetryJobRequest:
      type: object
      properties:
        target_hostname:
          type: string
          description: >-
            Override target hostname for the retried job. Defaults to _any if
            not specified.
          example: _any
          x-oapi-codegen-extra-tags:
            validate: omitempty,min=1
    ListJobsResponse:
      type: object
      properties:
        total_items:
          type: integer
          description: Total number of jobs matching the filter.
          example: 42
        items:
          type: array
          items:
            $ref: '#/components/schemas/JobDetailResponse'
    JobDetailResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier of the job.
        status:
          type: string
          description: Current status of the job.
        created:
          type: string
          description: Creation timestamp.
        operation:
          type: object
          description: The operation data.
          additionalProperties: true
        result:
          description: The result data if completed.
        error:
          type: string
          description: Error message if failed.
        hostname:
          type: string
          description: Worker hostname that processed the job.
        updated_at:
          type: string
          description: Last update timestamp.
        responses:
          type: object
          description: Per-worker response data for broadcast jobs.
          additionalProperties:
            type: object
            properties:
              status:
                type: string
              data:
                description: Worker result data.
              error:
                type: string
              hostname:
                type: string
        worker_states:
          type: object
          description: Per-worker processing state for broadcast jobs.
          additionalProperties:
            type: object
            properties:
              status:
                type: string
              error:
                type: string
              duration:
                type: string
        timeline:
          type: array
          description: Chronological sequence of job lifecycle events.
          items:
            type: object
            properties:
              timestamp:
                type: string
                description: ISO 8601 timestamp of the event.
              event:
                type: string
                description: >-
                  Event type (submitted, acknowledged, started, completed,
                  failed, retried).
              hostname:
                type: string
                description: Worker or source that generated the event.
              message:
                type: string
                description: Human-readable description of the event.
              error:
                type: string
                description: Error details if applicable.
    ListWorkersResponse:
      type: object
      properties:
        workers:
          type: array
          items:
            $ref: '#/components/schemas/WorkerInfo'
        total:
          type: integer
          description: Total number of active workers.
      required:
        - workers
        - total
    WorkerInfo:
      type: object
      properties:
        hostname:
          type: string
          description: The hostname of the worker.
      required:
        - hostname
    QueueStatsResponse:
      type: object
      properties:
        total_jobs:
          type: integer
          description: Total number of jobs in the queue.
          example: 42
        status_counts:
          type: object
          additionalProperties:
            type: integer
          description: Count of jobs by status.
        operation_counts:
          type: object
          additionalProperties:
            type: integer
          description: Count of jobs by operation type.
        dlq_count:
          type: integer
          description: Number of jobs in the dead letter queue.
    PingResponse:
      type: object
      properties:
        hostname:
          type: string
          description: The hostname of the worker that executed the ping.
        packets_sent:
          type: integer
          description: Number of packets sent.
          example: 4
        packets_received:
          type: integer
          description: Number of packets received.
          example: 4
        packet_loss:
          type: number
          format: double
          description: Percentage of packet loss.
          example: 0
        min_rtt:
          type: string
          description: Minimum round-trip time as a string in Go's time.Duration format.
          example: 14.637103ms
        avg_rtt:
          type: string
          description: Average round-trip time as a string in Go's time.Duration format.
          example: 18.647498ms
        max_rtt:
          type: string
          description: Maximum round-trip time as a string in Go's time.Duration format.
          example: 24.309240ms
        error:
          type: string
          description: Error message if the worker failed to process the request.
      required:
        - hostname
    PingCollectionResponse:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
          description: The job ID used to process this request.
          example: 550e8400-e29b-41d4-a716-446655440000
        results:
          type: array
          items:
            $ref: '#/components/schemas/PingResponse'
      required:
        - results
    DNSConfigResponse:
      type: object
      properties:
        hostname:
          type: string
          description: The hostname of the worker that served this DNS config.
        servers:
          type: array
          description: List of configured DNS servers.
          items:
            type: string
            description: IPv4 or IPv6 address of the DNS server.
        search_domains:
          type: array
          description: List of search domains.
          items:
            type: string
        error:
          type: string
          description: Error message if the worker failed to process the request.
      required:
        - hostname
    DNSConfigCollectionResponse:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
          description: The job ID used to process this request.
          example: 550e8400-e29b-41d4-a716-446655440000
        results:
          type: array
          items:
            $ref: '#/components/schemas/DNSConfigResponse'
      required:
        - results
    DNSUpdateResultItem:
      type: object
      properties:
        hostname:
          type: string
        status:
          type: string
          enum:
            - ok
            - failed
        error:
          type: string
      required:
        - hostname
        - status
    DNSUpdateCollectionResponse:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
          description: The job ID used to process this request.
          example: 550e8400-e29b-41d4-a716-446655440000
        results:
          type: array
          items:
            $ref: '#/components/schemas/DNSUpdateResultItem'
      required:
        - results
    DNSConfigUpdateRequest:
      type: object
      properties:
        servers:
          type: array
          x-oapi-codegen-extra-tags:
            validate: required_without=SearchDomains,omitempty,dive,ip,min=1
          description: New list of DNS servers to configure.
          items:
            type: string
            description: IPv4 or IPv6 address of the DNS server.
        search_domains:
          type: array
          x-oapi-codegen-extra-tags:
            validate: required_without=Servers,omitempty,dive,hostname,min=1
          description: New list of search domains to configure.
          items:
            type: string
        interface_name:
          type: string
          x-oapi-codegen-extra-tags:
            validate: required,alphanum
          description: >
            The name of the network interface to apply DNS configuration to.
            Must only contain letters and numbers.
      required:
        - interface_name
    LoadAverageResponse:
      type: object
      description: The system load averages for 1, 5, and 15 minutes.
      properties:
        1min:
          type: number
          description: Load average for the last 1 minute.
          example: 0.32
        5min:
          type: number
          description: Load average for the last 5 minutes.
          example: 0.28
        15min:
          type: number
          description: Load average for the last 15 minutes.
          example: 0.25
      required:
        - 1min
        - 5min
        - 15min
    MemoryResponse:
      type: object
      description: Memory usage information.
      properties:
        total:
          type: integer
          description: Total memory in bytes.
          example: 8388608
        free:
          type: integer
          description: Free memory in bytes.
          example: 2097152
        used:
          type: integer
          description: Used memory in bytes.
          example: 4194304
      required:
        - total
        - free
        - used
    DiskResponse:
      type: object
      description: Local disk usage information.
      properties:
        name:
          type: string
          description: Disk identifier, e.g., "/dev/sda1".
          example: /dev/sda1
        total:
          type: integer
          description: Total disk space in bytes.
          example: 500000000000
        used:
          type: integer
          description: Used disk space in bytes.
          example: 250000000000
        free:
          type: integer
          description: Free disk space in bytes.
          example: 250000000000
      required:
        - name
        - total
        - used
        - free
    DisksResponse:
      type: array
      description: List of local disk usage information.
      items:
        $ref: '#/components/schemas/DiskResponse'
    SystemStatusResponse:
      type: object
      properties:
        hostname:
          type: string
          description: The hostname of the system.
          example: my-linux-server
        uptime:
          type: string
          description: The uptime of the system.
          example: 0 days, 4 hours, 1 minute
        load_average:
          $ref: '#/components/schemas/LoadAverageResponse'
        memory:
          $ref: '#/components/schemas/MemoryResponse'
        disks:
          $ref: '#/components/schemas/DisksResponse'
        os_info:
          $ref: '#/components/schemas/OSInfoResponse'
        error:
          type: string
          description: Error message if the worker failed to process the request.
      required:
        - hostname
    HostnameResponse:
      type: object
      description: The hostname of the system.
      properties:
        hostname:
          type: string
          description: The system's hostname.
          example: my-linux-server
        labels:
          type: object
          additionalProperties:
            type: string
          description: Key-value labels configured on the worker.
        error:
          type: string
          description: Error message if the worker failed to process the request.
      required:
        - hostname
    SystemStatusCollectionResponse:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
          description: The job ID used to process this request.
          example: 550e8400-e29b-41d4-a716-446655440000
        results:
          type: array
          items:
            $ref: '#/components/schemas/SystemStatusResponse'
      required:
        - results
    HostnameCollectionResponse:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
          description: The job ID used to process this request.
          example: 550e8400-e29b-41d4-a716-446655440000
        results:
          type: array
          items:
            $ref: '#/components/schemas/HostnameResponse'
      required:
        - results
    OSInfoResponse:
      type: object
      description: Operating system information.
      properties:
        distribution:
          type: string
          description: The name of the Linux distribution.
          example: Ubuntu
        version:
          type: string
          description: The version of the Linux distribution.
          example: '20.04'
      required:
        - distribution
        - version
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
x-tagGroups:
  - name: OSAPI - A CRUD API for managing Linux systems
    tags:
      - OSAPI_-_A_CRUD_API_for_managing_Linux_systems_info
  - name: Health Check API
    tags:
      - Health_Check_API_health
  - name: Job Management API
    tags:
      - Job_Management_API_job_operations
  - name: Network Management API
    tags:
      - Network_Management_API_network_operations
      - Network_Management_API_dns_operations
  - name: System Management API
    tags:
      - System_Management_API_system_operations
      - System_Management_API_system_status
